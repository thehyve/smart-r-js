"use strict";angular.module("smartRApp",["transmartBaseUiConstants","tmEndpoints"]).config(["$httpProvider","$locationProvider",function(t,e){e.html5Mode({enabled:!0,requireBase:!1})}]),angular.module("smartRApp").run(["$templateCache",function(t){t.put("src/containers/boxplot/boxplot.content.html",'<div class="main-container">\n    <tab-container>\n\n        <workflow-tab tab-name="Fetch Data" disabled="fetch.disabled">\n            <concept-box style="display: inline-block" concept-group="fetch.conceptBoxes.datapoints" type="LD-numerical" min="1" max="1" label="Numerical Variable" tooltip="Select a single numerical variable that you would like to have displayed.">\n            </concept-box>\n            <!----Nice idea but somehow lost it\'s initial purpose because cross-study support is gone.\n            Maybe implement later--->\n            <!----<concept-box style="display: inline-block;"--->\n                             <!----concept-group="fetch.conceptBoxes.subsets"--->\n                             <!----type="LD-categorical"--->\n                             <!----min="0"--->\n                             <!----max="-1"--->\n                             <!----label="(optional) Categorical Variables"--->\n                             <!----tooltip="Select an arbitrary amount of categorical variables to split the numerical variable into subsets.">--->\n            <!----</concept-box>--->\n            <br>\n            <br>\n            <fetch-button concept-map="fetch.conceptBoxes" loaded="fetch.loaded" running="fetch.running" allowed-cohorts="[1,2]">\n            </fetch-button>\n        </workflow-tab>\n\n        <workflow-tab tab-name="Run Analysis" disabled="runAnalysis.disabled">\n            <br>\n            <br>\n            <run-button button-name="Create Plot" store-results-in="runAnalysis.scriptResults" script-to-run="run" arguments-to-use="runAnalysis.params" running="runAnalysis.running">\n            </run-button>\n            <capture-plot-button filename="boxplot.svg" target="boxplot"></capture-plot-button>\n            <br>\n            <br>\n            <boxplot data="runAnalysis.scriptResults" width="1000" height="500"></boxplot>\n        </workflow-tab>\n\n    </tab-container>\n\n</div>\n'),t.put("src/containers/boxplot/boxplot.html",'<div ui-layout="{flow : \'column\'}" class="base-ui-contents">\n    <div ui-layout-container size="20%" min-size="0%">\n        <div ui-view="sidebar"></div>\n    </div>\n\n    <div ui-layout-container min-size="40%">\n        <div ui-view="content"></div>\n    </div>\n</div>\n\n'),t.put("src/containers/correlation/correlation.content.html",'<div ng-controller="CorrelationController" class="main-container">\n\n        <tab-container>\n\n            <workflow-tab tab-name="Fetch Data" disabled="fetch.disabled">\n                <concept-box style="display: inline-block" concept-group="fetch.conceptBoxes.datapoints" type="LD-numerical" min="2" max="2" label="Numerical Variables" tooltip="Select two numerical variables from the tree to compare them.">\n                </concept-box>\n                <concept-box style="display: inline-block" concept-group="fetch.conceptBoxes.annotations" type="LD-categorical" min="0" max="-1" label="(optional) Categorical Variables" tooltip="Select an arbitrary amount of categorical variables from the tree to annotate the numerical datapoints.">\n                </concept-box>\n                <br>\n                <br>\n                <fetch-button concept-map="fetch.conceptBoxes" loaded="fetch.loaded" running="fetch.running" allowed-cohorts="[1]">\n                </fetch-button>\n            </workflow-tab>\n\n            <workflow-tab tab-name="Run Analysis" disabled="runAnalysis.disabled">\n                <div class="heim-input-field sr-input-area">\n                    <h2>Data transformation:</h2>\n                    <fieldset class="heim-radiogroup">\n                        <label>\n                            <input type="radio" ng-model="runAnalysis.params.transformation" value="raw" checked="checked"> Raw Values\n                        </label>\n                        <label>\n                            <input type="radio" ng-model="runAnalysis.params.transformation" value="log2" checked="checked"> Log2\n                        </label>\n                        <label>\n                            <input type="radio" ng-model="runAnalysis.params.transformation" value="log10" checked="checked"> Log10\n\n                        </label>\n                    </fieldset>\n                </div>\n                <div class="heim-input-field sr-input-area">\n                    <h2>Correlation computation method:</h2>\n                    <fieldset class="heim-radiogroup">\n                        <label>\n                            <input type="radio" ng-model="runAnalysis.params.method" value="pearson" checked="checked"> Pearson\n                        </label>\n                        <label>\n                            <input type="radio" ng-model="runAnalysis.params.method" value="kendall"> Kendall\n                        </label>\n                        <label>\n                            <input type="radio" ng-model="runAnalysis.params.method" value="spearman"> Spearman\n                        </label>\n                    </fieldset>\n                </div>\n                <hr class="sr-divider">\n                <run-button button-name="Create Plot" store-results-in="runAnalysis.scriptResults" script-to-run="run" arguments-to-use="runAnalysis.params" running="runAnalysis.running">\n                </run-button>\n                <capture-plot-button filename="correlation.svg" target="correlation-plot"></capture-plot-button>\n                <br>\n                <br>\n                <correlation-plot data="runAnalysis.scriptResults" width="1500" height="1500"></correlation-plot>\n            </workflow-tab>\n\n        </tab-container>\n\n    </div>\n\n\n'),t.put("src/containers/correlation/correlation.html",'<div ui-layout="{flow : \'column\'}" class="base-ui-contents">\n    <div ui-layout-container size="20%" min-size="0%">\n        <div ui-view="sidebar"></div>\n    </div>\n\n    <div ui-layout-container min-size="50%">\n        <div ui-view="content"></div>\n    </div>\n</div>\n\n'),t.put("src/containers/heatmap/heatmap.content.html",'<div ng-controller="HeatmapController" class="main-container">\n\n    <tab-container>\n        <!----========================================================================================================-->\n        <!---- Fetch Data -->\n        <!----========================================================================================================-->\n        <workflow-tab tab-name="Fetch Data" disabled="fetch.disabled">\n            <concept-box concept-group="fetch.conceptBoxes.highDimensional" type="HD" min="1" max="-1" label="High Dimensional" tooltip="Select high dimensional data node(s) from the data tree and drag it into the box.\n                The nodes need to be from the same platform.">\n            </concept-box>\n\n            <concept-box concept-group="fetch.conceptBoxes.numeric" type="LD-numerical" min="0" max="-1" label="(optional) Numerical Variables" tooltip="Select numeric data node(s) from the data tree and drag it into the box.">\n            </concept-box>\n\n            <concept-box concept-group="fetch.conceptBoxes.categoric" type="LD-categorical" min="0" max="-1" label="(optional) Categoric Variables" tooltip="Select categoric data node(s) from the data tree and drag it into the box.">\n            </concept-box>\n\n            <biomarker-selection biomarkers="fetch.selectedBiomarkers"></biomarker-selection>\n            <hr class="sr-divider">\n            <fetch-button loaded="fetch.loaded" running="fetch.running" concept-map="fetch.conceptBoxes" biomarkers="fetch.selectedBiomarkers" show-summary-stats="true" summary-data="fetch.scriptResults" all-samples="common.totalSamples" allowed-cohorts="[1,2]" number-of-rows="common.numberOfRows" has-preprocess-tab="true">\n            </fetch-button>\n            <br>\n            <summary-stats summary-data="fetch.scriptResults"></summary-stats>\n        </workflow-tab>\n\n        <!----========================================================================================================-->\n        <!---- Preprocess Data -->\n        <!----========================================================================================================-->\n        <workflow-tab tab-name="Preprocess" disabled="preprocess.disabled">\n            <!----Aggregate Probes-->\n            <div class="heim-input-field">\n                <input type="checkbox" ng-model="preprocess.params.aggregate">\n                <span>Aggregate probes</span>\n            </div>\n\n            <hr class="sr-divider">\n\n            <preprocess-button params="preprocess.params" show-summary-stats="true" summary-data="preprocess.scriptResults" running="preprocess.running" all-samples="common.totalSamples" number-of-rows="common.numberOfRows">\n            </preprocess-button>\n\n            <br>\n            <summary-stats summary-data="preprocess.scriptResults"></summary-stats>\n        </workflow-tab>\n\n\n        <!----========================================================================================================-->\n        <!----Run Analysis-->\n        <!----========================================================================================================-->\n        <workflow-tab tab-name="Run Analysis" disabled="runAnalysis.disabled">\n            <!----Number of max row to display-->\n            <div class="heim-input-field heim-input-number sr-input-area">\n                Show <input type="text" id="txtMaxRow" ng-model="runAnalysis.params.max_row">\n                of {{ common.numberOfRows }} rows in total. ( less than 1000 is preferable. )\n            </div>\n\n            <!----Type of sorting to apply-->\n            <div class="heim-input-field sr-input-area">\n                <h2>Group columns by:</h2>\n                <fieldset class="heim-radiogroup">\n                    <label>\n                        <input type="radio" ng-model="runAnalysis.params.sorting" name="sortingSelect" value="nodes" checked="checked"> Node Order\n                    </label>\n                    <label>\n                        <input type="radio" ng-model="runAnalysis.params.sorting" name="sortingSelect" value="subjects">\n                        Subject ID\n                    </label>\n                </fieldset>\n            </div>\n\n            <div class="heim-input-field sr-input-area">\n                <h2>I have read and accept the <a href="http://www.lifemapsc.com/genecards-suite-terms-of-use/" target="_blank">\n                    GeneCards TOU</a>\n                </h2>\n                <fieldset class="heim-radiogroup">\n                    <label>\n                        <input type="radio" ng-model="runAnalysis.params.geneCardsAllowed" name="geneCardsAllowedSelect" ng-value="true"> yes (use GeneCards)\n                    </label>\n                    <label>\n                        <input type="radio" ng-model="runAnalysis.params.geneCardsAllowed" name="geneCardsAllowedSelect" ng-value="false" checked="checked"> no (use EMBL EBI)\n                    </label>\n                </fieldset>\n            </div>\n\n            <!----Type of sorting to apply-->\n            <div class="heim-input-field sr-input-area">\n                <sorting-criteria criteria="runAnalysis.params.ranking" samples="common.totalSamples" subsets="common.subsets">\n                </sorting-criteria>\n            </div>\n\n            <hr class="sr-divider">\n\n            <run-button button-name="Create Plot" store-results-in="runAnalysis.scriptResults" script-to-run="run" arguments-to-use="runAnalysis.params" filename="heatmap.json" running="runAnalysis.running">\n            </run-button>\n            <capture-plot-button filename="heatmap.svg" disabled="runAnalysis.download.disabled" target="heatmap-plot">\n            </capture-plot-button>\n            <download-results-button disabled="runAnalysis.download.disabled"></download-results-button>\n            <br>\n            <workflow-warnings warnings="runAnalysis.scriptResults.warnings"></workflow-warnings>\n            <heatmap-plot data="runAnalysis.scriptResults" width="1200" height="1200" params="runAnalysis.params">\n            </heatmap-plot>\n\n        </workflow-tab>\n\n    </tab-container>\n</div>\n'),t.put("src/containers/heatmap/heatmap.html",'<div ui-layout="{flow : \'column\'}" class="base-ui-contents">\n    <div ui-layout-container size="20%" min-size="0%">\n        <div ui-view="sidebar"></div>\n    </div>\n\n    <div ui-layout-container min-size="50%">\n        <div ui-view="content"></div>\n    </div>\n</div>\n\n'),t.put("src/containers/templates/biomarkerSelection.html",'<div class="sr-fetch-params-area">\n  <div class="heim-input-field heim-autocomplete">\n    <label for="heim-input-txt-identifier">Select a biomarker:</label>\n    <input id="heim-input-txt-identifier">\n    <span style="color: darkgrey"> Biomarker can be a gene, pathway, mirID or UniProtID.</span>\n    <div id="heim-input-list-identifiers">\n      <ul><li ng-repeat="biomarker in biomarkers">\n        <div>\n          <span class="identifier-type">{{biomarker.type}} </span>\n          <span class="identifier-name">{{biomarker.name}} </span>\n          <span class="identifier-synonyms">{{biomarker.synonyms}} </span>\n        </div>\n        <button class="identifier-delete" ng-click="removeIdentifier(biomarker)">&#x2716;</button>\n      </li></ul>\n    </div>\n  </div>\n</div>\n'),t.put("src/containers/templates/boxplot.html",'<workflow-controls ng-show="showControls">\n    <div>\n        <label for="sr-boxplot-log-check">Log2</label>\n        <input type="checkbox" id="sr-boxplot-log-check">\n    </div>\n    <div>\n        <label for="sr-boxplot-jitter-check">Jitter</label>\n        <input type="checkbox" id="sr-boxplot-jitter-check">\n    </div>\n    <div>\n        <label for="sr-boxplot-kde-check">KDE</label>\n        <input type="checkbox" id="sr-boxplot-kde-check">\n    </div>\n    <div>\n        <input type="button" id="sr-boxplot-reset-btn" value="Reset">\n    </div>\n    <div>\n        <input type="button" id="sr-boxplot-remove-btn" value="Remove Outliers">\n    </div>\n</workflow-controls>\n<div id="visualisation"></div>\n'),t.put("src/containers/templates/conceptBox.html",'<div class="heim-input-field heim-dropzone sr-hd-input" data-drop="true" ng-model="droppedNode" jqyoui-droppable="{multiple:true, onDrop:\'onNodeDropEvent(droppedNode)\'}">\n    <label style="display: inline">{{label}} <i class="ui-icon ui-icon-info sr-tooltip-dialog" title="{{tooltip}}"> </i></label>\n    <br><br>\n    <span ng-show="instructionMinNodes" class="sr-instruction">Drag at least {{min}} node(s) into the box<br></span>\n    <span ng-show="instructionMaxNodes" class="sr-instruction">Select at most {{max}} node(s)<br></span>\n    <span ng-show="instructionNodeType" class="sr-instruction">Node(s) do not have the correct type<br></span>\n    <span ng-show="instructionNodePlatform" class="sr-instruction">Nodes must have the same platform</span>\n    <div class="sr-drop-input" ng-class="{true:\'sr-drop-input-valid\', false:\'sr-drop-input-invalid\'}[conceptGroup.valid]" style="overflow-y:auto">\n        <ul>\n            <li ng-repeat="node in conceptGroup.concepts"> {{node.title}}</li>\n        </ul>\n    </div>\n\n\n    <div style="margin-top: 10px; text-align: right">\n        <input type="button" value="Clear Window" class="sr-drop-btn">\n    </div>\n</div>\n'),t.put("src/containers/templates/fetchButton.html",'<input type="button" value="Fetch Data" class="heim-action-button">\n<span style="padding-left: 10px"></span>'),t.put("src/containers/templates/heatmap.html",'<workflow-controls ng-show="showControls">\n    <div>\n        <input type="checkbox" id="sr-heatmap-animate-check" checked="checked">\n        <label for="sr-heatmap-animate-check">Animate</label>\n    </div>\n    <div>\n        <div>\n            <input type="button" id="sr-heatmap-cutoff-btn" value="Apply Cutoff">\n            <input type="range" id="sr-heatmap-cutoff-range" min="0" step="1" value="0">\n        </div>\n        <label for="sr-heatmap-zoom-range">Zoom</label>\n        <input type="range" id="sr-heatmap-zoom-range" min="1" max="200" step="5" value="100">\n    </div>\n    <div>\n        <select id="sr-heatmap-cluster-select">\n            <option disabled="disabled" selected="selected" value> -- select a clustering -- </option>\n            <option value="hclustEuclideanAverage">Hierarch.-Eucl.-Avg.</option>\n            <option value="hclustEuclideanComplete">Hierarch.-Eucl.-Complete</option>\n            <option value="hclustEuclideanSingle">Hierarch.-Eucl.-Single</option>\n            <option value="hclustManhattanAverage">Hierarch.-Manhat.-Avg.</option>\n            <option value="hclustManhattanComplete">Hierarch.-Manhat.-Complete</option>\n            <option value="hclustManhattanSingle">Hierarch.-Manhat.-Single</option>\n        </select><br>\n        <div>\n            <input type="checkbox" id="sr-heatmap-row-check" checked="checked">\n            <label for="sr-heatmap-row-check">Cluster Row</label>\n            <input type="checkbox" id="sr-heatmap-col-check" checked="checked">\n            <label for="sr-heatmap-col-check">Cluster Col</label>\n        </div>\n    </div>\n    <div>\n        <select id="sr-heatmap-ranking-select">\n        </select><br>\n        <select id="sr-heatmap-color-select">\n            <option value="redGreen" selected="selected">Red to Green Schema</option>\n            <option value="redBlue">Red to Blue Schema</option>\n            <option value="blueScale">Blue Schema</option>\n            <option value="greenScale">Green Schema</option>\n        </select>\n    </div>\n</workflow-controls>\n<div id="visualisation"></div>\n'),t.put("src/containers/templates/preprocessButton.html",'<input type="button" value="Preprocess" class="heim-action-button">\n<span style="padding-left: 10px"></span>'),t.put("src/containers/templates/runButton.html",'<input type="button" value="{{name}}">\n<span style="padding-left: 10px"></span>\n'),t.put("src/containers/templates/sortingCriteria.html",'<h2>Ranking Criteria:</h2>\n<div class="heim-input-field-sub" id="sr-non-multi-subset">\n    <fieldset class="heim-radiogroup" id="sr-variability-group" ng-disabled="samples < 2">\n        <h3>Expression variability</h3>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="coef"> Coefficient of variation\n        </label></div>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="variance"> Variance\n        </label></div>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="range"> Range between max and min after\n            excluding outliers\n        </label></div>\n    </fieldset>\n    <fieldset class="heim-radiogroup" id="sr-expression-level-group">\n        <h3>Expression level</h3>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="mean"> Mean\n        </label></div>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="median"> Median\n        </label></div>\n    </fieldset>\n</div>\n<div class="heim-input-field-sub" id="sr-multi-subset">\n    <fieldset class="heim-radiogroup" id="sr-differential-exp-group" ng-disabled="subsets < 2">\n        <h3>Differential expression</h3>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="bval"> B-value/log odds ratio\n        </label></div>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="pval"> p-value\n        </label></div>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="adjpval"> Adjusted p-value (method “fdr”)\n        </label></div>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="logfold"> log fold-change\n        </label></div>\n        <div><label>\n            <input type="radio" ng-model="criteria" value="ttest"> t-statistic\n        </label></div>\n    </fieldset>\n</div>\n'),t.put("src/containers/templates/summaryStatistics.html",'<table class="sr-summary-table" ng-if="summaryData.summary.length > 0">\n    <thead>\n    <tr>\n        <th>Plot</th>\n        <th>Labels</th>\n        <th>Subset 1</th>\n        <th ng-if="summaryData.summary[0].$$state.value.json.data.length > 1">Subset 2</th>\n    </tr>\n    </thead>\n    <tr ng-repeat="item in summaryData.summary">\n        <td><img ng-src="{{images[item.$$state.value.img]}}" width="300px"></td>\n        <td>\n            <ul ng-repeat="(key, value) in item.$$state.value.json.data[0]">\n                <li>{{key}} : </li>\n            </ul>\n        </td>\n        <td>\n            <ul ng-repeat="(key, value) in item.$$state.value.json.data[0]">\n                <li>{{value}}</li>\n            </ul>\n        </td>\n        <td ng-if="item.$$state.value.json.data.length > 1">\n            <ul ng-repeat="(key, value) in item.$$state.value.json.data[1]">\n                <li>{{value}}</li>\n            </ul>\n        </td>\n    </tr>\n</table>\n'),t.put("src/containers/templates/tabContainer.html",'<div id="heim-tabs" style="margin-top: 25px">\n    <ul>\n        <li class="heim-tab" ng-repeat="tab in tabs">\n            <a href="#{{tab.id}}" ng-style="{\'color\': tab.disabled ? \'grey\' : \'black\', \'pointer-events\': tab.disabled ? \'none\' : null}">\n                {{tab.name}}\n            </a>\n        </li>\n    </ul>\n    <ng-transclude-replace></ng-transclude-replace>\n</div>'),t.put("src/containers/templates/workflowControls.html",'<div class="sr-workflow-controls" ng-transclude></div>\n\n'),t.put("src/containers/templates/workflowWarnings.html",'<div class="sr-warning-box" ng-style="{\'visibility\': visibility}">\n    {{text}}\n</div>\n'),t.put("src/containers/timeline/timeline.content.html",'<div ng-controller="TimelineController" class="main-container">\n\n\t\t<tab-container>\n\n\t\t\t<workflow-tab tab-name="Fetch Data">\n\t\t\t\t<concept-box concept-group="conceptBoxes.datapoints"></concept-box>\n\t\t\t\t<br>\n\t\t\t\t<br>\n\t\t\t\t<fetch-button concept-map="conceptBoxes"></fetch-button>\n\t\t\t</workflow-tab>\n\n\t\t\t<workflow-tab tab-name="Run Analysis">\n\t\t\t\t<run-button button-name="Create Plot" results-storage="scriptResults" script-to-run="run" parameter-map="params"></run-button>\n\t\t\t\t<br>\n\t\t\t\t<br>\n\t\t\t\t<timeline-plot data="scriptResults" width="1200" height="1200"></timeline-plot>\n\t\t\t</workflow-tab>\n\n\t\t</tab-container>\n\n</div>\n'),t.put("src/containers/timeline/timeline.html",'<div ui-layout="{flow : \'column\'}" class="base-ui-contents">\n    <div ui-layout-container size="20%" min-size="0%">\n        <div ui-view="sidebar"></div>\n    </div>\n\n    <div ui-layout-container min-size="50%">\n        <div ui-view="content"></div>\n    </div>\n</div>\n\n'),t.put("src/containers/volcanoplot/volcanoplot.content.html",'<div ng-controller="VolcanoplotController" class="main-container">\n\n    <tab-container>\n\n            <workflow-tab tab-name="Fetch Data" disabled="fetch.disabled">\n                <concept-box style="display: inline-block" concept-group="fetch.conceptBoxes.highDimensional" type="HD" min="1" max="-1" label="High Dimensional Variables" tooltip="Select high dimensional data node(s) from the data tree and drag it into the box.\n                             The nodes needs to be from the same platform.">\n            </concept-box>\n            <br>\n            <br>\n            <fetch-button concept-map="fetch.conceptBoxes" loaded="fetch.loaded" running="fetch.running" allowed-cohorts="[2]">\n            </fetch-button>\n        </workflow-tab>\n\n            <workflow-tab tab-name="Run Analysis" disabled="runAnalysis.disabled">\n                <run-button button-name="Create Plot" store-results-in="runAnalysis.scriptResults" script-to-run="run" arguments-to-use="runAnalysis.params" filename="volcanoplot.json" running="runAnalysis.running">\n                </run-button>\n                <capture-plot-button filename="volcanoplot.svg" target="volcano-plot"></capture-plot-button>\n                <br>\n                <br>\n                <volcano-plot data="runAnalysis.scriptResults" width="1000" height="800"></volcano-plot>\n            </workflow-tab>\n\n    </tab-container>\n\n</div>\n'),t.put("src/containers/volcanoplot/volcanoplot.html",'<div ui-layout="{flow : \'column\'}" class="base-ui-contents">\n    <div ui-layout-container size="20%" min-size="0%">\n        <div ui-view="sidebar"></div>\n    </div>\n\n    <div ui-layout-container min-size="50%">\n        <div ui-view="content"></div>\n    </div>\n</div>\n\n')}]),angular.module("smartRApp").controller("BoxplotController",["$scope","smartRUtils","commonWorkflowService",function(t,e,n){n.initializeWorkflow("boxplot",t),t.fetch={running:!1,disabled:!1,loaded:!1,conceptBoxes:{datapoints:{concepts:[],valid:!1}}},t.runAnalysis={running:!1,disabled:!0,scriptResults:{},params:{}},t.$watchGroup(["fetch.running","runAnalysis.running"],function(e){var n=e[0],a=e[1];n&&(t.runAnalysis.scriptResults={}),t.fetch.disabled=a,t.runAnalysis.disabled=n||!t.fetch.loaded})}]),angular.module("smartRApp").controller("CorrelationController",["$scope","smartRUtils","commonWorkflowService",function(t,e,n){n.initializeWorkflow("correlation",t),t.fetch={disabled:!1,running:!1,loaded:!1,conceptBoxes:{datapoints:{concepts:[],valid:!1},annotations:{concepts:[],valid:!0}}},t.runAnalysis={disabled:!0,running:!1,scriptResults:{},params:{method:"pearson",transformation:"raw"}},t.$watch("runAnalysis.params.transformation",function(e,n){e!==n&&"raw"!==e&&"pearson"===t.runAnalysis.params.method&&(t.runAnalysis.params.method="spearman")}),t.$watchGroup(["fetch.running","runAnalysis.running"],function(e){var n=e[0],a=e[1];n&&(t.runAnalysis.scriptResults={}),t.fetch.disabled=a,t.runAnalysis.disabled=n||!t.fetch.loaded})}]),angular.module("smartRApp").controller("HeatmapController",["$scope","commonWorkflowService","smartRUtils",function(t,e,n){e.initializeWorkflow("heatmap",t),t.fetch={disabled:!1,running:!1,loaded:!1,conceptBoxes:{highDimensional:{concepts:[],valid:!1},numeric:{concepts:[],valid:!0},categoric:{concepts:[],valid:!0}},selectedBiomarkers:[],scriptResults:{}},t.preprocess={disabled:!0,running:!1,params:{aggregate:!1},scriptResults:{}},t.runAnalysis={disabled:!0,running:!1,params:{selections:{selectedRownames:[]},max_row:100,sorting:"nodes",ranking:"coef",geneCardsAllowed:!1},download:{disabled:!0},scriptResults:{}},t.common={totalSamples:0,numberOfRows:0,subsets:0},t.$watchGroup(["fetch.running","preprocess.running","runAnalysis.running"],function(e){var a=e[0],r=e[1],o=e[2];a&&(t.preprocess.scriptResults={},t.runAnalysis.scriptResults={},t.runAnalysis.params.ranking="",t.common.subsets=n.countCohorts()),r&&(t.runAnalysis.scriptResults={},t.runAnalysis.params.ranking="",t.common.subsets=n.countCohorts()),t.fetch.disabled=r||o,t.preprocess.disabled=a||o||!t.fetch.loaded,t.runAnalysis.disabled=a||r||!t.fetch.loaded,t.runAnalysis.download.disabled=o||$.isEmptyObject(t.runAnalysis.scriptResults),!a&&!r&&t.common.totalSamples<2&&""===t.runAnalysis.params.ranking?t.runAnalysis.params.ranking="mean":!a&&!r&&t.common.subsets<2&&""===t.runAnalysis.params.ranking?t.runAnalysis.params.ranking="coef":!a&&!r&&t.common.subsets>1&&""===t.runAnalysis.params.ranking&&(t.runAnalysis.params.ranking="adjpval")})}]),angular.module("smartRApp").controller("TimelineController",["$scope","smartRUtils","commonWorkflowService",function(t,e,n){n.initializeWorkflow("timeline",t),t.conceptBoxes={},t.scriptResults={},t.params={}}]),angular.module("smartRApp").controller("VolcanoplotController",["$scope","smartRUtils","commonWorkflowService",function(t,e,n){n.initializeWorkflow("volcanoplot",t),t.fetch={disabled:!1,running:!1,loaded:!1,conceptBoxes:{highDimensional:{concepts:[],valid:!1}}},t.runAnalysis={params:{},disabled:!0,running:!1,scriptResults:{}},t.$watchGroup(["fetch.running","runAnalysis.running"],function(e){var n=e[0],a=e[1];n&&(t.runAnalysis.scriptResults={}),t.fetch.disabled=a,t.runAnalysis.disabled=n||!t.fetch.loaded})}]),angular.module("smartRApp").directive("biomarkerSelection",["$rootScope","EndpointService","$http",function(t,e,n){return{restrict:"E",scope:{biomarkers:"="},templateUrl:"src/containers/templates/biomarkerSelection.html",controller:["$scope",function(t){t.biomarkers||(t.biomarkers=[]);var a=$("#heim-input-txt-identifier");a.autocomplete({source:function(t,e){var n=t.term;return n.length<2?function(){return e({rows:[]})}:r(n,function(t){var n=t.rows.map(function(t){return{label:t.keyword,value:t}});return e(n)})},minLength:2}),a.data("ui-autocomplete")._renderItem=function(t,e){var n=e.value;return jQuery('<li class="ui-menu-item" role="presentation"><a class="ui-corner-all"><span class="category-gene">'+n.display+"&gt;</span>&nbsp;<b>"+n.keyword+"</b>&nbsp;"+n.synonyms+"</a></li>").appendTo(t)},a.on("autocompleteselect",function(e,n){var a=n.item.value;return 0==t.biomarkers.filter(function(t){return t.id==a.id}).length&&(t.biomarkers.push({id:a.id,type:a.display,name:a.keyword,synonyms:a.synonyms}),t.$apply()),this.value="",!1}),a.on("autocompletefocus",function(t,e){var n=e.item.value;return this.value=n.display+" "+n.keyword,!1});var r=function(){var t=e.getMasterEndpoint().url,a=e.getMasterEndpoint().restangular.defaultHeaders,r=null;return function(e,o){return r&&"pending"===r.state()&&r.abort(),r=n({url:t+"/search/loadSearchPathways?query="+e,headers:a}),r.always(function(){r=null}),r.then(function(t){t=t.substring(5,t.length-1),o(JSON.parse(t))},function(){o({rows:[]})})}}();t.removeIdentifier=function(e){var n=t.biomarkers.indexOf(e);n>=0&&t.biomarkers.splice(n,1)}}]}}]),angular.module("smartRApp").directive("capturePlotButton",[function(){var t=function(t){function e(t){var e=t.prop("nodeName");if(!r[e]){var n=jQuery(document.createElement(e)).appendTo(o);r[e]=window.getComputedStyle(n[0])}return r[e]}var n=["fill-opacity","fill","stroke","font-size","font-family","font-weight","shape-rendering","stroke-width","opacity","text-anchor"],a=jQuery(t).clone().attr("display","none");a.insertAfter(t);var r={},o=jQuery(document.createElement("svg")).attr("display","none").appendTo(jQuery("body"));return a.find("*").each(function(t,a){var r=window.getComputedStyle(a),o=jQuery(a);n.forEach(function(t){var n=r.getPropertyValue(t),a=e(o).getPropertyValue(t);n!==a&&o.attr(t,n)})}),o.remove(),a},e=function(e,n){var a=new XMLSerializer,r=t(e),o=a.serializeToString(r[0]),i=new Blob([o],{type:"image/svg+xml"}),l=URL.createObjectURL(i),s=jQuery("<a/>").attr("href",l).attr("download",n).css("display","none");jQuery("body").append(s),s[0].click(),s.remove(),URL.revokeObjectURL(l),r.remove()};return{restrict:"E",scope:{disabled:"=?",filename:"@",target:"@"},template:'<input type="button" value="Capture" class="heim-action-button" ng-click="capture()">',link:function(t,n){var a=n.children()[0];a.disabled=t.disabled,t.$watch("disabled",function(t){a.disabled=t},!0),t.filename||(t.filename="image.svg"),t.capture=function(){var n=$(t.target+" svg")[0];n&&e(n,t.filename)}}}}]),angular.module("smartRApp").directive("cohortSummaryInfo",[function(){return{restrict:"E",template:'<span id="sr-cohort-selection" style="font-size: 11px;"></span>',controller:["$scope","$element",function(t,e){function n(){for(var t="",e=1;e<=GLOBAL.NumOfSubsets;e++){var n=getQuerySummary(e);""!==n&&(t+="<br/>Subset "+e+": <br/>",t+=n,t+="<br/>")}t||(t='<br/>WARNING: No subsets have been selected! Please go to the "Comparison" tab and select your subsets.'),
a.innerHTML=t}var a=e.children()[0];t.$evalAsync(function(){n(),$("#resultsTabPanel__smartRPanel").on("click",function(){n()})})}]}}]),angular.module("smartRApp").directive("conceptBox",["$rootScope","$http","EndpointService",function(t,e,n){return{restrict:"E",scope:{conceptGroup:"=",label:"@",tooltip:"@",min:"@",max:"@",type:"@"},templateUrl:"src/containers/templates/conceptBox.html",link:function(t,e){var n=parseInt(t.max),a=parseInt(t.min),r=e[0].querySelector(".sr-drop-input"),o=e[0].querySelector(".sr-drop-btn"),i=e[0].querySelector(".sr-tooltip-dialog");$(i).tooltip({track:!0,tooltipClass:"sr-ui-tooltip"});var l=function(){$(r).children().remove()},s=function(){return $(r).children().toArray().map(function(t){return t.getAttribute("conceptid")})},c={hleaficon:"HD",alphaicon:"LD-categorical",null:"LD-categorical",CATEGORICAL_OPTION:"LD-categorical",valueicon:"LD-numerical"},u=function(){return $(r).children().toArray().every(function(e){return c[e.getAttribute("setnodetype")]===t.type})};t.$evalAsync(function(){}),o.addEventListener("click",function(){l()}),new MutationObserver(function(){t.conceptGroup.concepts=s(),t.validate(),t.$apply()}).observe(r,{childList:!0}),t.validate=function(){t.instructionMinNodes=t.conceptGroup.concepts.length<a,t.instructionMaxNodes=n!==-1&&t.conceptGroup.concepts.length>n,t.instructionNodeType=!u(),t.instructionNodePlatform=!1},t.$watchGroup(["instructionNodeType","instructionNodePlatform","instructionMaxNodes","instructionMinNodes"],function(e){var n=e[0],a=e[1],r=e[2],o=e[3];t.conceptGroup.valid=!(n||a||r||o)}),t.validate()}}}]),angular.module("smartRApp").directive("downloadResultsButton",["rServeService",function(t){function e(e){var n=jQuery("<a/>").attr("href",t.urlForFile(e.executionId,"analysis_data.zip")).attr("download","analysis_data.zip").css("display","none");jQuery("body").append(n),n[0].click(),n.remove()}return{restrict:"E",scope:{disabled:"="},template:'<input type="button" value="Download" class="heim-action-button"><span style="padding-left: 10px;"></span>',link:function(n,a){var r=a.children()[0],o=a.children()[1];r.disabled=n.disabled,n.$watch("disabled",function(t){r.disabled=t},!0),r.onclick=function(){o.innerHTML='Download data, please wait <span class="blink_me">_</span>',t.startScriptExecution({taskType:"downloadData",arguments:{}}).then(function(t){o.innerHTML="",e(t)},function(t){o.innerHTML="Failure: "+t})}}}}]),angular.module("smartRApp").directive("fetchButton",["$rootScope","rServeService","smartRUtils",function(t,e,n){return{restrict:"E",scope:{conceptMap:"=",loaded:"=?",running:"=?",biomarkers:"=?",showSummaryStats:"=?",summaryData:"=?",allSamples:"=?",numberOfRows:"=?",allowedCohorts:"=",projection:"@?",hasPreprocessTab:"=?"},templateUrl:"src/containers/templates/fetchButton.html",link:function(t,a){var r=a.children()[0],o=a.children()[1],i=function(){t.hasPreprocessTab?o.innerHTML='Task complete! Go to the "Preprocess" or "Run Analysis" tab to continue.':o.innerHTML='Task complete! Go to the "Run Analysis" tab to continue.',t.loaded=!0,r.disabled=!1,t.running=!1},l=function(e){o.innerHTML="Error: "+e,t.loaded=!1,r.disabled=!1,t.running=!1};t.$watch("summaryData",function(e){t.summaryData&&t.showSummaryStats&&t.running&&Object.keys(e).indexOf("subsets")!==-1&&(t.allSamples=e.allSamples,t.numberOfRows=e.numberOfRows,i())},!0);var s=function(t){if("undefined"!=typeof t&&t.length>0){var e=t.map(function(t){return String(t.id)});return{search_keyword_ids:{keyword_ids:e}}}},c=function(){o.innerHTML='Executing summary statistics, please wait <span class="blink_me">_</span>',e.executeSummaryStats("fetch").then(function(e){t.summaryData=e.result},l)};r.onclick=function(){r.disabled=!0,o.innerHTML='Fetching data, please wait <span class="blink_me">_</span>',t.summaryData={},t.allSamples=0,t.loaded=!1,t.running=!0;var a=e.deleteSessionFiles(),u=n.countCohorts();if(0===u)return void l("No cohorts selected!");if(t.allowedCohorts.indexOf(u)===-1)return void l("This workflow requires "+t.allowedCohorts+" cohort(s), but you selected "+u);for(var d in t.conceptMap)if(t.conceptMap.hasOwnProperty(d)&&!t.conceptMap[d].valid)return void l("Your data do not match the requirements! All fields must be green.");var p=n.conceptBoxMapToConceptKeys(t.conceptMap);if($.isEmptyObject(p))return void l("No concepts selected!");var m=s(t.biomarkers);a.then(e.loadDataIntoSession(p,m,t.projection).then(t.showSummaryStats?c:i,l),l)}}}}]),angular.module("smartRApp").directive("ngTranscludeReplace",["$log",function(t){return{terminal:!0,restrict:"EA",link:function(e,n,a,r,o){return o?void o(function(t){t.length?n.replaceWith(t):n.remove()}):void t.error("orphan","Illegal use of ngTranscludeReplace directive in the template! No parent directive that requires a transclusion found. ")}}}]),angular.module("smartRApp").directive("preprocessButton",["rServeService","$rootScope",function(t,e){return{restrict:"E",scope:{running:"=?",params:"=?",showSummaryStats:"=",summaryData:"=",allSamples:"=?",numberOfRows:"=?",projection:"@?"},templateUrl:"src/containers/templates/preprocessButton.html",link:function(e,n){var a=n.children()[0],r=n.children()[1],o=function(){r.innerHTML='Task complete! Go to the "Run Analysis" tab to continue.',a.disabled=!1,e.running=!1},i=function(t){r.innerHTML="Error: "+t,a.disabled=!1,e.running=!1};e.$watch("summaryData",function(t){e.summaryData&&e.showSummaryStats&&e.running&&Object.keys(t).indexOf("subsets")!==-1&&(e.allSamples=t.allSamples,e.numberOfRows=t.numberOfRows,o())},!0);var l=function(){r.innerHTML='Execute summary statistics, please wait <span class="blink_me">_</span>',t.executeSummaryStats("preprocess",e.projection).then(function(t){e.summaryData=t.result},i)};a.onclick=function(){e.summaryData={},e.disabled=!0,e.running=!0,r.innerHTML='Preprocessing, please wait <span class="blink_me">_</span>';var n=e.params?e.params:{};t.preprocess(n).then(e.showSummaryStats?l:o,i)}}}}]),angular.module("smartRApp").directive("runButton",["$rootScope","rServeService","smartRUtils",function(t,e,n){return{restrict:"E",scope:{running:"=?",storage:"=storeResultsIn",script:"@scriptToRun",name:"@buttonName",filename:"@?",params:"=?argumentsToUse",waitMessage:"@?"},templateUrl:"src/containers/templates/runButton.html",link:function(t,a){var r=t.params?t.params:{};t.waitMessage||(t.waitMessage="Creating plot, please wait");var o=a.children()[0],i=a.children()[1],l=function(e){t.storage=e,i.innerHTML="",o.disabled=!1,t.disabled=!1,t.running=!1},s=function(e){i.innerHTML="Error: "+e,o.disabled=!1,t.disabled=!1,t.running=!1},c=function(n){t.filename?e.downloadJsonFile(n.executionId,t.filename).then(function(t){l(t.data)},s):l(JSON.parse(n.result.artifacts.value))};o.onclick=function(){n.cleanUp(),o.disabled=!0,t.storage={},t.disabled=!0,t.running=!0,i.innerHTML=t.waitMessage+' <span class="blink_me">_</span>',e.startScriptExecution({taskType:t.script,arguments:r}).then(c,s)}}}}]),angular.module("smartRApp").directive("sortingCriteria",["$rootScope",function(t){return{restrict:"E",scope:{criteria:"=",samples:"=",subsets:"="},templateUrl:"src/containers/templates/sortingCriteria.html"}}]),angular.module("smartRApp").directive(["summaryStats","$rootScope",function(t){return{restrict:"E",scope:{summaryData:"="},templateUrl:"src/containers/templates/summaryStatistics.html"}}]),angular.module("smartRApp").directive("tabContainer",["$rootScope","smartRUtils","$timeout",function(t,e,n){return{restrict:"E",transclude:!0,templateUrl:"src/containers/templates/tabContainer.html",controller:["$scope",function(t){t.tabs=[],this.addTab=function(e){t.tabs.push(e)}}],link:function(){n(function(){$("#heim-tabs").tabs()})}}}]),angular.module("smartRApp").directive("workflowControls",["$rootScope","smartRUtils",function(t,e){return{restrict:"E",transclude:!0,templateUrl:"src/containers/templates/workflowControls.html",link:function(t,n){var a=n.children()[0],r=e.getScrollBarWidth();a.style.bottom=r+"px",a.style.right=r+"px"}}}]),angular.module("smartRApp").directive("workflowTab",["smartRUtils",function(t){return{restrict:"E",scope:{name:"@tabName",disabled:"="},require:"^tabContainer",transclude:!0,template:"<ng-transclude-replace></ng-transclude-replace>",link:function(e,n,a,r){var o="fragment-"+t.makeSafeForCSS(e.name);e.id=o,n[0].id=o,r.addTab(e)}}}]),angular.module("smartRApp").directive("workflowWarnings",["$rootScope",function(t){return{restrict:"E",scope:{warnings:"="},templateUrl:"src/containers/templates/workflowWarnings.html",link:function(t){t.$watch("warnings",function(){t.visibility=$.isEmptyObject(t.warnings)?"hidden":"visible",t.text="";for(var e in t.warnings)t.warnings.hasOwnProperty(e)&&(t.text+=t.warnings[e]+"\n")},!0)}}}]),angular.module("smartRApp").factory("commonWorkflowService",["rServeService",function(t){var e={};return e.initializeWorkflow=function(n,a){e.currentScope=a,t.destroyAndStartSession(n)},e}]),angular.module("smartRApp").factory("rServeService",["smartRUtils","$q","$http","EndpointService",function(t,e,n,a){function r(){window.clearTimeout(p.touchTimeout),p.touchTimeout=window.setTimeout(function(){l.touch(p.sessionId)},d)}function o(t,a,r){var l=e.defer(),c=n({method:"GET",timeout:l.promise,headers:{Authorization:f},url:i+"/ScriptExecution/status?sessionId="+p.sessionId+"&executionId="+t});c.finally(function(){p.currentRequestAbort=s}),p.currentRequestAbort=function(){l.resolve()},c.then(function(e){"FINISHED"===e.data.state?(e.data.executionId=t,a(e.data)):"FAILED"===e.data.state?r(e.data.result.exception):window.setTimeout(function(){o(t,a,r)},u)},function(t){r(t.statusText)})}var i=a.getMasterEndpoint().url,l={},s=function(){},c=1e4,u=500,d=6e4,p={currentRequestAbort:s,sessionId:null,touchTimeout:null},m="",f="";return l.startSession=function(t){var o=a.getMasterEndpoint().restangular.defaultHeaders;f=o.Authorization,i=a.getMasterEndpoint().url,m=t;var l=n({url:i+"/RSession/create",method:"POST",headers:{"Content-Type":"application/json",Authorization:f,Accept:"application/hal+json"},config:{timeout:c},data:{workflow:m}});return e(function(t,e){l.then(function(e){p.sessionId=e.data.sessionId,r(),t()},function(t){e(t.statusText)})})},l.fetchImageResource=function(t){var r=a.getMasterEndpoint().restangular.defaultHeaders;f=r.Authorization;var o=e.defer(),i={};return i.Authorization=f,n({method:"GET",headers:i,url:t,responseType:"arraybuffer",eventHandlers:{progress:function(t){o.notify(t)}}}).then(function(t){var e=new Uint8Array(t.data),n=String.fromCharCode.apply(null,e),a=btoa(n),r="data:image/jpeg;base64,"+a;return o.resolve(r)}).catch(function(t){return o.reject({status:this.status,statusText:xmlHTTP.statusText})}),o.promise},l.touch=function(t){if(t===p.sessionId){var e=n({url:i+"/RSession/touch",method:"POST",headers:{"Content-Type":"application/json",Authorization:f},config:{timeout:c},data:{sessionId:t}});e.finally(function(){r()})}},l.deleteSessionFiles=function(t){return t=t||p.sessionId,n({url:i+"/RSession/deleteFiles",method:"POST",headers:{"Content-Type":"application/json",Authorization:f},config:{timeout:c},data:{sessionId:t}})},l.destroySession=function(t){if(t=t||p.sessionId){var e=n({url:i+"/RSession/delete",method:"POST",headers:{"Content-Type":"application/json",Authorization:f},config:{timeout:c},data:{sessionId:t}});return e.finally(function(){p.sessionId===t&&l.abandonCurrentSession()})}},l.abandonCurrentSession=function(){window.clearTimeout(p.touchTimeout),p.sessionId=null},l.destroyAndStartSession=function(t){e.when(l.destroySession()).then(function(){l.startSession(t)})},l.startScriptExecution=function(t){var a=$.extend({},t);p.currentRequestAbort();var l=e.defer(),c={url:i+"/ScriptExecution/run",method:"POST",timeout:l.promise,responseType:"json",headers:{"Content-Type":"application/json",Authorization:f},data:{sessionId:p.sessionId,arguments:a.arguments,taskType:a.taskType,workflow:m}};console.log(c);var u=n(c);u.finally(function(){p.currentRequestAbort=s}),p.currentRequestAbort=function(){l.resolve()};var d=e(function(t,e){u.then(function(n){n.data||console.error("Unexpected response:",n),a.executionId=n.data.executionId,o(a.executionId,t,e)},function(t){e(t.statusText)})});return d.cancel=function(){p.currentRequestAbort()},window.clearTimeout(p.touchTimeout),d.finally(r.bind(this)),d},l.downloadJsonFile=function(t,e){return n({method:"GET",url:this.urlForFile(t,e),headers:{Authorization:f}})},l.urlForFile=function(t,e){return i+"/ScriptExecution/downloadFile?sessionId="+p.sessionId+"&executionId="+t+"&filename="+e},l.loadDataIntoSession=function(n,a,r){return r="undefined"==typeof r?"log_intensity":r,e(function(e,o){t.getSubsetIds().then(function(t){var i={conceptKeys:n,resultInstanceIds:t,projection:r};"undefined"!=typeof a&&(i.dataConstraints=a),console.log(i),l.startScriptExecution({taskType:"fetchData",arguments:i}).then(e,function(t){o(t)})},function(){o("Could not create subsets!")})})},l.executeSummaryStats=function(t,n){return n="undefined"==typeof n?"log_intensity":n,e(function(e,a){l.startScriptExecution({taskType:"summary",arguments:{phase:t,projection:n}}).then(function(n){n.result.artifacts.files.length>0?l.composeSummaryResults(n.result.artifacts.files,n.executionId,t).then(function(t){e({result:t})},function(t){a(t.statusText)}):e({result:{}})},function(t){a(t)})})},l.composeSummaryResults=function(t,n,a){return e(function(r,o){for(var i={summary:[],allSamples:0,numberOfRows:0},s={fetch:[".png","json"],preprocess:["all.png","all.json"]},c=function(t,e){for(var n=[],a=0;a<e.length;a++)e[a].search(t)>-1&&n.push(e[a]);return n},u=function(t,a){return e(function(e){l.downloadJsonFile(n,a).then(function(a){i.subsets=a.data.length,a.data.forEach(function(t){i.allSamples+=t.numberOfSamples,i.numberOfRows=t.totalNumberOfValuesIncludingMissing/t.numberOfSamples}),e({img:l.urlForFile(n,t),json:a})},function(t){o(t)})})},d=c(s[a][0],t),p=c(s[a][1],t),m=0;m<d.length;m++)i.summary.push(u(d[m],p[m]));$.when.apply($,i.summary).then(function(){r(i)})})},l.preprocess=function(t){return e(function(e,n){l.startScriptExecution({taskType:"preprocess",arguments:t}).then(e,function(t){n(t)})})},l}]),angular.module("smartRApp").factory("smartRUtils",["$q","CohortSharingService",function(t,e){var n={},a=function(t){return t.restObj.key};return n.conceptBoxMapToConceptKeys=function(t){var e={};return Object.keys(t).forEach(function(n){var r=t[n].concepts;r.forEach(function(t,r){e[n+"_n"+r]=a(t)})}),e},n.makeSafeForCSS=function(t){return String(t).replace(/[^a-z0-9]/g,function(t){var e=t.charCodeAt(0);return 32===e?"-":e>=65&&e<=90?"_"+t.toLowerCase():"__"+("000"+e.toString(16)).slice(-4)})},n.getElementWithoutEventListeners=function(t){var e=document.getElementById(t),n=e.cloneNode(!0);return e.parentNode.replaceChild(n,e),n},n.shortenConcept=function(t){var e=t.split("\\");return e=e.filter(function(t){return""!==t}),e[e.length-2]+"/"+e[e.length-1]},$.fn.textWidth=function(t,e){return $.fn.textWidth.fakeEl||($.fn.textWidth.fakeEl=$("<span>").hide().appendTo(document.body)),$.fn.textWidth.fakeEl.text(t||this.val()||this.text()).css("font",e||this.css("font")),$.fn.textWidth.fakeEl.width()},n.getTextWidth=function(t,e){return $.fn.textWidth(t,e)},n.callOnScroll=function(t){$("#sr-index").parent().scroll(function(){var e=$(this).scrollTop();t(e)})},n.prepareWindowSize=function(t,e){$("#heim-tabs").css("min-width",parseInt(t)+25),$("#heim-tabs").css("min-height",parseInt(e)+25)},n.cleanUp=function(){$(".d3-tip").remove()},n.countCohorts=function(){return e.getSelection().length},n.getSubsetIds=function(){var n=t.defer();return n.resolve(e.getSelection()),n.promise},n}]),angular.module("smartRApp").controller("BoxplotController",["$scope","smartRUtils","commonWorkflowService",function(t,e,n){n.initializeWorkflow("boxplot",t),t.fetch={running:!1,disabled:!1,loaded:!1,conceptBoxes:{datapoints:{concepts:[],valid:!1}}},t.runAnalysis={running:!1,disabled:!0,scriptResults:{},params:{}},t.$watchGroup(["fetch.running","runAnalysis.running"],function(e){var n=e[0],a=e[1];n&&(t.runAnalysis.scriptResults={}),t.fetch.disabled=a,t.runAnalysis.disabled=n||!t.fetch.loaded})}]),angular.module("smartRApp").directive("boxplot",["smartRUtils","rServeService","$rootScope",function(t,e,n){function a(n,a){function r(t){y=t.concept[0],x=t.globalMin[0],w=t.globalMax[0],A=t["Subset 2"]?["Subset 1","Subset 2"]:["Subset 1"],k=t.excludedPatientIDs,S=t.useLog[0]}function o(){t.getElementWithoutEventListeners("sr-boxplot-exclude-btn").addEventListener("click",function(){_.hide(),l()}),t.getElementWithoutEventListeners("sr-boxplot-reset-btn-2").addEventListener("click",function(){_.hide(),b()})}function i(){d3.selectAll(".point").classed("brushed",!1);var t=j.extent(),e=t[0][0],n=t[0][1],a=t[1][0],r=t[1][1];V=d3.selectAll(".point").filter(function(t){var o=d3.select(this);return P(t.value)>=n&&P(t.value)<=r&&o.attr("cx")>=e&&o.attr("cx")<=a}).classed("brushed",!0).data().map(function(t){return t.patientID})}function l(){k=k.concat(V);var t={excludedPatientIDs:k,useLog:L.checked};e.startScriptExecution({taskType:"run",arguments:t}).then(function(t){s(),n.data=JSON.parse(t.result.artifacts.value)},function(t){console.error(t)})}function s(){d3.select(a).selectAll("*").remove(),d3.selectAll(".d3-tip").remove()}function c(){V=d3.selectAll(".outlier").data().map(function(t){return t.patientID}),V&&l()}function u(t,e){return function(n){return e.map(function(e){return[e,d3.mean(n,function(n){return t(e-n)})]})}}function d(t){return function(e){return Math.abs(e/=t)<=1?.75*(1-e*e)/t:0}}function p(t){t?d3.selectAll(".line").attr("visibility","visible"):d3.selectAll(".line").attr("visibility","hidden")}function m(t){return t=t.replace(/\W+/g,"")}function f(){A.forEach(function(e){d3.selectAll(".point."+t.makeSafeForCSS(m(e))).transition().duration(O).attr("cx",function(t){return T.checked?W(e)+B*q*t.jitter:W(e)})})}function h(){var t={excludedPatientIDs:k,useLog:L.checked};e.startScriptExecution({taskType:"run",arguments:t}).then(function(t){s(),n.data=JSON.parse(t.result.artifacts.value)},function(t){console.error(t)})}function g(e,n,a){var r=m(n);$.domain(d3.extent(P.domain()));var o=a.selectAll(".whisker").data([e.upperWhisker,e.lowerWhisker],function(t,e){return r+"-whisker-"+e});o.enter().append("line").attr("class","whisker"),o.transition().duration(O).attr("x1",W(n)-I/2).attr("y1",function(t){return P(t)}).attr("x2",W(n)+I/2).attr("y2",function(t){return P(t)});var i=a.selectAll(".whiskerLabel").data([e.upperWhisker,e.lowerWhisker],function(t,e){return r+"-whiskerLabel-"+e});i.enter().append("text").attr("class","whiskerLabel boxplotValue"),i.transition().duration(O).attr("x",W(n)+I/2).attr("y",function(t){return P(t)}).attr("dx",".35em").attr("dy",".35em").attr("text-anchor","start").text(function(t){return t});var l=B,s=a.selectAll(".hinge").data([e.upperHinge,e.lowerHinge],function(t,e){return r+"-hinge-"+e});s.enter().append("line").attr("class","hinge"),s.transition().duration(O).attr("x1",W(n)-l/2).attr("y1",function(t){return P(t)}).attr("x2",W(n)+l/2).attr("y2",function(t){return P(t)});var c=a.selectAll(".hingeLabel").data([e.upperHinge,e.lowerHinge],function(t,e){return r+"-hingeLabel-"+e});c.enter().append("text").attr("class","hingeLabel boxplotValue"),c.transition().duration(O).attr("x",W(n)-l/2).attr("y",function(t){return P(t)}).attr("dx","-.35em").attr("dy",".35em").attr("text-anchor","end").text(function(t){return t});var p=a.selectAll(".connection").data([[e.upperWhisker,e.upperHinge],[e.lowerWhisker,e.lowerHinge]],function(t,e){return r+"-connection-"+e});p.enter().append("line").attr("class","connection"),p.transition().duration(O).attr("x1",W(n)).attr("y1",function(t){return P(t[0])}).attr("x2",W(n)).attr("y2",function(t){return P(t[1])});var f=a.selectAll(".box.upper").data(e.upperHinge,function(t){return t});f.enter().append("rect").attr("class","box upper"),f.transition().duration(O).attr("x",W(n)-l/2).attr("y",P(e.upperHinge)).attr("height",Math.abs(P(e.upperHinge)-P(e.median))).attr("width",l);var h=a.selectAll(".box.lower").data(e.lowerHinge,function(t){return t});h.enter().append("rect").attr("class","box lower"),h.transition().duration(O).attr("x",W(n)-l/2).attr("y",P(e.median)).attr("height",Math.abs(P(e.median)-P(e.lowerHinge))).attr("width",l);var g=a.selectAll(".medianLabel").data(e.median,function(t){return t});g.enter().append("text").attr("class","medianLabel boxplotValue"),g.transition().duration(O).attr("x",W(n)+l/2).attr("y",function(){return P(e.median)}).attr("dx",".35em").attr("dy",".35em").attr("text-anchor","start").text(e.median);var v=a.selectAll(".point").data(e.rawData,function(t){return r+"-"+t.patientID});v.enter().append("circle").attr("cx",function(t){return T.checked?W(n)+B*q*t.jitter:W(n)}).attr("r",0).attr("fill",function(t){return $(t.value)}).on("mouseover",function(t){H.show("Value: "+t.value+"</br>PatientID: "+t.patientID+"</br>Outlier: "+t.outlier)}).on("mouseout",function(){H.hide()}),v.attr("class",function(e){return"point patientID-"+t.makeSafeForCSS(e.patientID)+(e.outlier?" outlier ":" ")+t.makeSafeForCSS(r)}).transition().duration(O).attr("cy",function(t){return P(t.value)}).attr("r",3),v.exit().transition().duration(O).attr("r",0).remove();var b=P.copy();b.domain([e.lowerWhisker,e.upperWhisker]);var y=u(d(6),b.ticks(100)),x=e.rawData.map(function(t){return t.value}),w=y(x),A=d3.extent(w,function(t){return t[1]}),k=d3.scale.linear().domain(A).range([0,B/2]),S=d3.svg.line().x(function(t){return W(n)-k(t[1])}).y(function(t){return P(t[0])});a.append("path").attr("class","line").attr("visibility","hidden").datum(w).transition().duration(O).attr("d",S)}function v(){d3.selectAll(".brush").call(j.clear())}function b(){v(),k=[],V=[],l()}var y="",x=Number.MIN_VALUE,w=Number.MAX_VALUE,A=[],k=[],S=!1;r(n.data);var E=t.getElementWithoutEventListeners("sr-boxplot-remove-btn");E.addEventListener("click",c);var C=t.getElementWithoutEventListeners("sr-boxplot-reset-btn");C.addEventListener("click",b);var R=t.getElementWithoutEventListeners("sr-boxplot-kde-check");R.addEventListener("change",function(){p(R.checked)}),R.checked=!1;var T=t.getElementWithoutEventListeners("sr-boxplot-jitter-check");T.addEventListener("change",function(){f(T.checked)}),T.checked=!1;var L=t.getElementWithoutEventListeners("sr-boxplot-log-check");L.checked=S,L.addEventListener("change",function(){h(L.checked)});var O=1e3,M=parseInt(n.width),F=parseInt(n.height),D={top:20,right:60,bottom:200,left:280},B=.12*M,I=B/6,$=d3.scale.quantile().range(["rgb(158,1,66)","rgb(213,62,79)","rgb(244,109,67)","rgb(253,174,97)","rgb(254,224,139)","rgb(255,255,191)","rgb(230,245,152)","rgb(171,221,164)","rgb(102,194,165)","rgb(50,136,189)","rgb(94,79,162)"]),N=d3.select(a).append("svg").attr("width",M+D.left+D.right).attr("height",F+D.top+D.bottom).append("g").attr("transform","translate("+D.left+","+D.top+")"),W=d3.scale.ordinal().domain(A).rangeBands([0,M],1,.5),P=d3.scale.linear().domain([x,w]).range([F,0]),z=d3.svg.axis().scale(P).orient("left"),U=d3.svg.axis().scale(W).orient("bottom");N.append("g").attr("class","y axis").attr("transform","translate(0,0)").call(z),N.append("g").attr("class","x axis").attr("transform","translate(0,"+(F+20)+")").call(U).selectAll("text").attr("dy",".35em").attr("transform","translate(0,5)rotate(45)").style("text-anchor","start"),N.append("text").attr("transform","translate(-40,"+F/2+")rotate(-90)").attr("text-anchor","middle").text(t.shortenConcept(y)+(S?" (log2)":""));var H=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t});N.call(H);var j=d3.svg.brush().x(d3.scale.identity().domain([0,M])).y(d3.scale.identity().domain([-5,F+5])).on("brush",function(){_.hide(),i()});N.append("g").attr("class","brush").on("mousedown",function(){2===d3.event.button&&d3.event.stopImmediatePropagation()}).call(j);var _=d3.tip().attr("class","d3-tip sr-contextmenu").html(function(t){return t});N.call(_),N.on("contextmenu",function(){d3.event.preventDefault(),_.show('<input id="sr-boxplot-exclude-btn" value="Exclude" class="sr-ctx-menu-btn"><br/><input id="sr-boxplot-reset-btn-2" value="Reset" class="sr-ctx-menu-btn">'),o()});var V,q=1,G={};A.forEach(function(t){G[t]=N.append("g");var e=n.data[t];g(e,t,G[t])})}return{restrict:"E",scope:{data:"=",width:"@",height:"@"},templateUrl:"src/containers/templates/boxplot.html",link:function(e,n){var r=n.children()[0],o=n.children()[1];e.$watch("data",function(){$(o).empty(),$.isEmptyObject(e.data)||(t.prepareWindowSize(e.width,e.height),e.showControls=!0,a(e,o,r))})}}}]),angular.module("smartRApp").config(["$stateProvider",function(t){t.state("boxplot",{parent:"site",url:"/boxplot",views:{"@":{templateUrl:"src/containers/boxplot/boxplot.html"},"content@boxplot":{templateUrl:"src/containers/boxplot/boxplot.content.html",controller:"BoxplotController",controllerAs:"vm"},"sidebar@boxplot":{templateUrl:"app/components/sidebar/sidebar.html",controller:"SidebarCtrl",controllerAs:"vm"}}})}]),angular.module("smartRApp").directive("correlationPlot",["smartRUtils","rServeService",function(t,e){function n(n,a){function r(t){F=t.correlation[0],D=t.pvalue[0],B=t.regLineSlope[0],I=t.regLineYIntercept[0],W=t.method[0],P=t.transformation[0],$=t.patientIDs,N=t.points;var e=t.points.map(function(t){return t.x}),n=t.points.map(function(t){return t.y});z=Math.min.apply(null,e),H=Math.min.apply(null,n),U=Math.max.apply(null,e),j=Math.max.apply(null,n)}function o(t,a,o){o||(t=0!==t.length?t:d3.selectAll(".point").data().map(function(t){return t.patientID}));var l={method:W,transformation:P,selectedPatientIDs:t};e.startScriptExecution({taskType:"run",arguments:l}).then(function(t){var e=JSON.parse(t.result.artifacts.value);o?(i(),n.data=e):(r(e),a&&p(),h(),f(),m())},function(t){console.error(t)})}function i(){d3.select(a).selectAll("*").remove(),d3.selectAll(".d3-tip").remove()}function l(){t.getElementWithoutEventListeners("sr-correlation-zoom-btn").addEventListener("click",function(){J.hide(),c()}),t.getElementWithoutEventListeners("sr-correlation-exclude-btn").addEventListener("click",function(){J.hide(),s()}),t.getElementWithoutEventListeners("sr-correlation-reset-btn").addEventListener("click",function(){J.hide(),g()})}function s(){var t=d3.selectAll(".point:not(.selected)").data().map(function(t){return t.patientID});o(t,!0)}function c(){if(d3.selectAll(".point.selected").size()<2)return void alert("Please select at least two elements before zooming!");var t=d3.selectAll(".point.selected").data().map(function(t){return t.patientID});o(t,!1,!0)}function u(){var t=Q.extent(),e=R.invert(t[0][0]),n=R.invert(t[1][0]),a=T.invert(t[0][1]),r=T.invert(t[1][1]);q.selectAll(".point").classed("selected",!1).style("fill",function(t){return d(t.annotation)}).style("stroke","white").filter(function(t){return e<=t.x&&t.x<=n&&r<=t.y&&t.y<=a}).classed("selected",!0).style("fill","white").style("stroke",function(t){return d(t.annotation)})}function d(t){return t&&"Default"!==t?C[L.indexOf(t)]:"black"}function p(){var e=q.selectAll(".point").data(N,function(t){return t.patientID});e.enter().append("circle").attr("class","point").attr("cx",function(t){return R(t.x)}).attr("cy",function(t){return T(t.y)}).attr("r",5).style("fill",function(t){return d(t.annotation)}).on("mouseover",function(e){d3.select(this).style("fill","#FF0000"),G.show(t.shortenConcept(_)+": "+e.x+"<br/>"+t.shortenConcept(V)+": "+e.y+"<br/>Patient ID: "+e.patientID+"<br/>"+(e.annotation?"Tag: "+e.annotation:""))}).on("mouseout",function(){var t=d3.select(this);t.style("fill",function(e){return t.classed("selected")?"#FFFFFF":d(e.annotation)}),G.hide()}),e.exit().classed("selected",!1).transition().duration(v).attr("r",0).remove()}function m(){var t=d3.layout.histogram().bins(b)(N.map(function(t){return t.x})),e=d3.layout.histogram().bins(b)(N.map(function(t){return t.y})),n=d3.scale.linear().domain([0,Math.max.apply(null,t.map(function(t){return t.y}))]).range([1,S]),a=d3.scale.linear().domain([0,Math.max.apply(null,e.map(function(t){return t.y}))]).range([2,E]),r=q.selectAll(".bar.bottom").data(Array(b).fill().map(function(t,e){return e})),o=r.enter().append("g").attr("class","bar bottom"),i=r.exit();o.append("rect").attr("y",k+1),r.selectAll("rect").transition().delay(function(t){return 25*t}).duration(v).attr("x",function(e){return R(t[e].x)}).attr("width",function(){return(R(U)-R(z))/b}).attr("height",function(e){return n(t[e].y)-1}),i.selectAll("rect").transition().duration(v).attr("height",0),o.append("text").attr("dy",".35em").attr("text-anchor","middle"),r.selectAll("text").text(function(e){return t[e].y||""}).transition().delay(function(t){return 25*t}).duration(v).attr("x",function(e){return R(t[e].x)+(R(U)-R(z))/b/2}).attr("y",function(e){return k+n(t[e].y)-10}),i.selectAll("text").text("");var l=q.selectAll(".bar.left").data(Array(b).fill().map(function(t,e){return e})),s=l.enter().append("g").attr("class","bar left"),c=l.exit();s.append("rect"),l.selectAll("rect").transition().delay(function(t){return 25*t}).duration(v).attr("x",function(t){return-a(e[t].y)+1}).attr("y",function(t){return T(e[t].x)-(T(H)-T(j))/b}).attr("width",function(t){return a(e[t].y)-2}).attr("height",function(){return(T(H)-T(j))/b}),c.selectAll("rect").transition().duration(v).attr("height",0),s.append("text").attr("dy",".35em").attr("text-anchor","middle"),l.selectAll("text").text(function(t){return e[t].y||""}).transition().delay(function(t){return 25*t}).duration(v).attr("x",function(t){return-a(e[t].y)+10}).attr("y",function(t){return T(e[t].x)-(T(H)-T(j))/b/2}),c.selectAll("text").text("")}function f(){var t=15,e=10,n=[{name:"Correlation Coefficient: "+F},{name:"p-value: "+D},{name:"Method: "+W},{name:"Selected: "+d3.selectAll(".point.selected").size()||d3.selectAll(".point").size()},{name:"Displayed: "+d3.selectAll(".point").size()}];L.forEach(function(t){n.push({color:d(t),name:t})});var a=q.selectAll(".legend").data(n,function(t){return t.name}),r=a.enter().append("g").attr("class","legend").attr("transform",function(n,a){return"translate("+(A+40)+","+a*(e+t)+")"});r.append("text"),r.append("rect"),a.select("text").attr("x",function(t){return t.color?20:0}).attr("y",9).text(function(t){return t.name}),a.select("rect").attr("width",e).attr("height",e).style("fill",function(t){return t.color}).style("visibility",function(t){return t.color?"visible":"hidden"}),a.exit().remove()}function h(){var t=q.selectAll(".regressionLine").data("NA"===B?[]:[0],function(t){return t});t.enter().append("line").attr("class","regressionLine").on("mouseover",function(){d3.select(this).attr("stroke","red"),G.show("slope: "+B+"<br/>intercept: "+I)}).on("mouseout",function(){d3.select(this).attr("stroke","orange"),G.hide()});var e=R(z),n=T(I+B*z),a=R(U),r=T(I+B*U);e=e<0?0:e,e=e>A?A:e,a=a<0?0:a,a=a>A?A:a,n=n<0?0:n,n=n>k?k:n,r=r<0?0:r,r=r>k?k:r,t.transition().duration(v).attr("x1",e).attr("y1",n).attr("x2",a).attr("y2",r),t.exit().remove()}function g(){o([],!0,!0)}for(var v=500,b=10,y=parseInt(n.width),x=parseInt(n.height),w={top:20,right:250,bottom:x/4+230,left:y/4},A=3*y/4-w.left-w.right,k=3*x/4-w.top-w.bottom,S=w.bottom,E=w.left,C=["#33FF33","#3399FF","#CC9900","#CC99FF","#FFFF00","blue"],R=d3.scale.linear().domain(d3.extent(n.data.points,function(t){return t.x})).range([0,A]),T=d3.scale.linear().domain(d3.extent(n.data.points,function(t){return t.y})).range([k,0]),L=n.data.annotations.sort(),O=0;O<L.length;O++){var M=L[O];""===M&&(L[O]="Default")}var F,D,B,I,$,N,W,P,z,U,H,j,_=n.data.xArrLabel[0],V=n.data.yArrLabel[0];r(n.data);var q=d3.select(a).append("svg").attr("width",A+w.left+w.right).attr("height",k+w.top+w.bottom).append("g").attr("transform","translate("+w.left+","+w.top+")").on("contextmenu",function(){d3.event.preventDefault(),J.show('<input id="sr-correlation-zoom-btn" value="Zoom" class="sr-ctx-menu-btn"><br/><input id="sr-correlation-exclude-btn" value="Exclude" class="sr-ctx-menu-btn"><br/><input id="sr-correlation-reset-btn" value="Reset" class="sr-ctx-menu-btn">'),
l()}),G=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t});q.call(G),q.append("g").attr("class","x axis").attr("transform","translate(0, 0)").call(d3.svg.axis().scale(R).ticks(10).tickFormat("").innerTickSize(k).orient("bottom")),q.append("text").attr("class","axisLabels").attr("transform","translate("+A/2+","+-10+")").text(t.shortenConcept(_)+" ("+P+")"),q.append("g").attr("class","y axis").attr("transform","translate("+A+",0)").call(d3.svg.axis().scale(T).ticks(10).tickFormat("").innerTickSize(A).orient("left")),q.append("text").attr("class","axisLabels").attr("transform","translate("+(A+10)+","+k/2+")rotate(90)").text(t.shortenConcept(V)+" ("+P+")"),q.append("g").attr("class","x axis").attr("transform","translate(0,"+k+")").call(d3.svg.axis().scale(R).orient("top")),q.append("g").attr("class","y axis").attr("transform","translate(0,0)").call(d3.svg.axis().scale(T).orient("right"));var J=d3.tip().attr("class","d3-tip sr-contextmenu").offset([-10,0]).html(function(t){return t});q.call(J);var Q=d3.svg.brush().x(d3.scale.identity().domain([0,A])).y(d3.scale.identity().domain([0,k])).on("brushend",function(){J.hide(),u();var t=d3.selectAll(".point.selected").data().map(function(t){return t.patientID});o(t)});q.append("g").attr("class","brush").on("mousedown",function(){return 2===d3.event.button?d3.event.stopImmediatePropagation():null}).call(Q),p(),m(),h(),f()}return{restrict:"E",scope:{data:"=",width:"@",height:"@"},link:function(e,a){e.$watch("data",function(){$(a[0]).empty(),$.isEmptyObject(e.data)||(t.prepareWindowSize(e.width,e.height),n(e,a[0]))})}}}]),angular.module("smartRApp").config(["$stateProvider",function(t){t.state("correlation",{parent:"site",url:"/correlation",views:{"@":{templateUrl:"src/containers/correlation/correlation.html"},"content@correlation":{templateUrl:"src/containers/correlation/correlation.content.html"},"sidebar@correlation":{templateUrl:"app/components/sidebar/sidebar.html",controller:"SidebarCtrl",controllerAs:"vm"}}})}]),angular.module("smartRApp").directive("heatmapPlot",["smartRUtils","$rootScope","EndpointService",function(t,e,n){function a(e,n){function a(){et=d3.scale.linear().domain(d3.extent(H.map(function(t){return t[U]}))).range("PVAL"===U||"ADJPVAL"===U?[J,0]:[0,J]),nt=function(t){return et("TTEST"===U||"LOGFOLD"===U?Math.abs(t):t)}}function r(t){switch(U){case"PVAL":case"ADJPVAL":return 1-t;case"TTEST":case"LOGFOLD":return Math.abs(t);default:return t}}function o(){$(ht[0]).closest("svg").attr("width",Z.left+Z.right+V*F.length).attr("height",Z.top+Z.bottom+q*D.length)}function i(){function e(e,n){var a=d3.select(".square.colname-"+t.makeSafeForCSS(e)+".rowname-"+t.makeSafeForCSS(n));return a[0][0]?a.property("__data__").ZSCORE:(-Math.pow(2,32)).toString()}function n(t){return t.every(function(e,n){if(n===t.length-1)return!0;var a=t[n][1]-t[n+1][1];return isNaN(a)?t[n][1].localeCompare(t[n+1][1])<=0:a>=0})}l();var a=bt.selectAll(".square").data(L);a.enter().append("rect").attr("class",function(e){return"square colname-"+t.makeSafeForCSS(e.COLNAME)+" rowname-"+t.makeSafeForCSS(e.ROWNAME)}).attr("x",function(t){return F.indexOf(t.COLNAME)*V}).attr("y",function(t){return D.indexOf(t.ROWNAME)*q}).attr("width",V).attr("height",q).on("mouseover",function(e){d3.select(".colname.colname-"+t.makeSafeForCSS(e.COLNAME)).classed("highlight",!0),d3.select(".rowname.rowname-"+t.makeSafeForCSS(e.ROWNAME)).classed("highlight",!0);var n="Log2: "+e.VALUE+"<br/>z-Score: "+e.ZSCORE+"<br/>Column: "+e.COLNAME+"<br/>Row: "+e.ROWNAME+"<br/>PatientId: "+e.PATIENTID+"</br>Subset: "+e.SUBSET+"<br/>";gt.show(n)}).on("mouseout",function(){d3.selectAll(".colname").classed("highlight",!1),d3.selectAll(".rowname").classed("highlight",!1),gt.hide()}),a.transition().duration(at.checked?T:0).attr("x",function(t){return F.indexOf(t.COLNAME)*V}).attr("y",function(t){return D.indexOf(t.ROWNAME)*q}).attr("width",V).attr("height",q);var o=yt.selectAll(".colSortText").data(F);o.enter().append("text").attr("class","colSortText").attr("dy","0.35em").style("text-anchor","middle").text("↑↓"),o.transition().duration(at.checked?T:0).attr("x",function(t,e){return e*V+.5*V}).attr("y",-2-q+.5*q).style("font-size",q+"px");var i=yt.selectAll(".colSortBox").data(F);i.enter().append("rect").attr("class",function(t,e){return"box colSortBox idx-"+e}).on("click",function(t){var a=D.map(function(n,a){return[a,e(t,n)]});n(a)?a.sort(function(t,e){return t[1]-e[1]}):a.sort(function(t,e){return e[1]-t[1]});var r=a.map(function(t){return t[0]});w(r),d3.selectAll(".colSortBox").classed("sortedBy",!1),d3.selectAll(".significanceSortBox").classed("sortedBy",!1),d3.select(this).classed("sortedBy",!0);var o=d3.selectAll(".sortedBy").filter(".rowSortBox");if(!o.empty()){var i=o.attr("class"),l=parseInt(i.match(/idx-(\d+)/)[1]);d3.selectAll(".rowSortBox").classed("sortedBy",!1),d3.selectAll(".rowSortBox").filter(".idx-"+r.indexOf(l)).classed("sortedBy",!0)}}),i.transition().duration(at.checked?T:0).attr("x",function(t,e){return e*V}).attr("y",-2-q).attr("width",V).attr("height",q);var s=At.selectAll(".rowSortText").data(D);s.enter().append("text").attr("class","rowSortText").attr("dy","0.35em").style("text-anchor","middle").text("↑↓"),s.transition().duration(at.checked?T:0).style("font-size",q+"px").attr("transform",function(t,e){return"translate("+(K+2+.5*V)+",0)translate(0,"+(e*q+.5*q)+")rotate(-90)"});var c=At.selectAll(".rowSortBox").data(D);c.enter().append("rect").attr("class",function(t,e){return"box rowSortBox idx-"+e}).on("click",function(t){var a=F.map(function(n,a){return[a,e(n,t)]});n(a)?a.sort(function(t,e){return t[1]-e[1]}):a.sort(function(t,e){return e[1]-t[1]});var r=a.map(function(t){return t[0]});x(r),d3.selectAll(".rowSortBox").classed("sortedBy",!1),d3.selectAll(".featureSortBox").classed("sortedBy",!1),d3.select(this).classed("sortedBy",!0);var o=d3.selectAll(".sortedBy").filter(".colSortBox");if(!o.empty()){var i=o.attr("class"),l=parseInt(i.match(/idx-(\d+)/)[1]);d3.selectAll(".colSortBox").classed("sortedBy",!1),d3.selectAll(".colSortBox").filter(".idx-"+r.indexOf(l)).classed("sortedBy",!0)}}),c.transition().duration(at.checked?T:0).attr("x",K+2).attr("y",function(t,e){return e*q}).attr("width",V).attr("height",q);var u=kt.selectAll(".significanceSortText").data(["something"]);u.enter().append("text").attr("class","significanceSortText").attr("dy","0.35em").style("text-anchor","middle").text("↑↓"),u.transition().duration(at.checked?T:0).style("font-size",q+"px").attr("x",-V-10+.5*V).attr("y",-2-q+.5*q);var d=kt.selectAll(".significanceSortBox").data(["something"]);d.enter().append("rect").attr("class","box significanceSortBox").on("click",function(){var t=H.map(function(t){return t[U]}).map(function(t,e){return[e,r(t)]});n(t)?t.sort(function(t,e){return t[1]-e[1]}):t.sort(function(t,e){return e[1]-t[1]});var e=t.map(function(t){return t[0]});w(e),d3.selectAll(".colSortBox").classed("sortedBy",!1),d3.select(this).classed("sortedBy",!0);var a=d3.selectAll(".sortedBy").filter(".rowSortBox");if(!a.empty()){var o=a.attr("class"),i=parseInt(o.match(/idx-(\d+)/)[1]);d3.selectAll(".rowSortBox").classed("sortedBy",!1),d3.selectAll(".rowSortBox").filter(".idx-"+e.indexOf(i)).classed("sortedBy",!0)}}),d.transition().duration(at.checked?T:0).attr("x",-V-10).attr("y",-2-q).attr("width",V).attr("height",q);var m=xt.selectAll(".selectText").data(F,function(t){return t});m.enter().append("text").attr("class",function(e){return"selectText colname-"+t.makeSafeForCSS(e)}).attr("dy","0.35em").style("text-anchor","middle").text("□"),m.transition().duration(at.checked?T:0).style("font-size",q+"px").attr("x",function(t,e){return e*V+.5*V}).attr("y",-2-2*q+.5*q);var f=xt.selectAll(".selectBox").data(F);f.enter().append("rect").attr("class","box selectBox").on("click",function(t){p(t)}),f.transition().duration(at.checked?T:0).attr("x",function(t,e){return e*V}).attr("y",-2-2*q).attr("width",V).attr("height",q);var h=wt.selectAll(".colname").data(F,function(t){return t});h.enter().append("text").attr("class",function(e){return"colname colname-"+t.makeSafeForCSS(e)}).style("text-anchor","start").text(function(t){return t}),h.transition().duration(at.checked?T:0).style("font-size",q+"px").attr("transform",function(t){return"translate("+F.indexOf(t)*V+",0)translate("+V/2+","+(-4-2*q)+")rotate(-45)"});var g=St.selectAll(".rowname").data(D,function(t){return t});g.enter().append("text").attr("class",function(e){return"rowname rowname-"+t.makeSafeForCSS(e)}).attr("dy","0.35em").style("text-anchor","start").text(function(t){return t}).on("click",function(t){var e=t.split("--");e.shift();var n=[];_?e.forEach(function(t){n.push("http://www.genecards.org/cgi-bin/carddisp.pl?gene="+t)}):e.forEach(function(t){n.push("https://www.ebi.ac.uk/ebisearch/search.ebi?db=allebi&query="+t)}),n.forEach(function(t){window.open(t)})}),g.transition().duration(at.checked?T:0).style("font-size",q+"px").attr("x",K+V+7).attr("y",function(t){return D.indexOf(t)*q+.5*q});var v=Et.selectAll(".bar").data(H,function(t){return t.ROWNAME});v.enter().append("rect").on("mouseover",function(e){var n="";for(var a in e)e.hasOwnProperty(a)&&"ROWNAME"!==a&&(n+=(a===U?"(ranked by) ":"")+a+": "+e[a]+"<br/>");gt.show(n),d3.selectAll(".square.rowname-"+t.makeSafeForCSS(e.ROWNAME)).classed("squareHighlighted",!0),d3.select(".rowname.rowname-"+t.makeSafeForCSS(e.ROWNAME)).classed("highlight",!0)}).on("mouseout",function(){gt.hide(),d3.selectAll(".square").classed("squareHighlighted",!1),d3.selectAll(".rowname").classed("highlight",!1)}),v.attr("class",function(e){return"bar rowname-"+t.makeSafeForCSS(e.ROWNAME)}).transition().duration(at.checked?T:0).attr("width",function(t){return nt(t[U])}).attr("height",q).attr("y",function(t){return q*D.indexOf(t.ROWNAME)}).attr("x",function(t){return-nt(t[U])}).style("fill",function(t){return t[U]>0?"#990000":"steelblue"});var b=2*-V-I+20,y=vt.selectAll(".extraSquare").data(O);y.enter().append("rect").attr("class",function(e){return"extraSquare colname-"+t.makeSafeForCSS(e.COLNAME)+" rowname-"+t.makeSafeForCSS(e.ROWNAME)}).on("mouseover",function(e){d3.select(".colname.colname-"+t.makeSafeForCSS(e.COLNAME)).classed("highlight",!0),d3.select(".feature.feature-"+t.makeSafeForCSS(e.ROWNAME)).classed("highlight",!0);var n="Value: "+e.VALUE+"<br/>"+(e.ZSCORE?"z-Score: "+e.ZSCORE+"<br/>":"")+"Row: "+e.ROWNAME+"<br/>PatientId: "+e.PATIENTID+"<br/>Type: "+e.TYPE+"<br/>Subset: "+e.SUBSET;gt.show(n)}).on("mouseout",function(){gt.hide(),d3.selectAll(".colname").classed("highlight",!1),d3.selectAll(".feature").classed("highlight",!1)}),y.transition().duration(at.checked?T:0).attr("x",function(t){return F.indexOf(t.COLNAME)*V}).attr("y",function(t){return b-M.indexOf(t.ROWNAME)*q}).attr("width",V).attr("height",q);var A=vt.selectAll(".feature").data(M);A.enter().append("text").attr("class",function(e){return"feature feature-"+t.makeSafeForCSS(e)}).attr("dy","0.35em").style("text-anchor","start").text(function(t){return t}),A.transition().duration(at.checked?T:0).style("font-size",q+"px").attr("x",K+V+7).attr("y",function(t){return b-M.indexOf(t)*q+q/2});var k=vt.selectAll(".featureSortText").data(M);k.enter().append("text").attr("class","featureSortText").attr("dy","0.35em").style("text-anchor","middle").text("↑↓"),k.transition().duration(at.checked?T:0).style("font-size",q+"px").attr("transform",function(t){return"translate("+(K+2+.5*V)+",0)translate(0,"+(b-M.indexOf(t)*q+q/2)+")rotate(-90)"});var S=vt.selectAll(".featureSortBox").data(M);S.enter().append("rect").attr("class","box featureSortBox").on("click",function(e){var a=F.map(function(n,a){var r="extraSquare rowname-"+t.makeSafeForCSS(e)+" colname-"+t.makeSafeForCSS(n),o=document.getElementsByClassName(r),i=(-Math.pow(2,32)).toString();if(o.length>0){var l=d3.select(o[0]);i=l.property("__data__").VALUE}return[a,i]});n(a)?a.sort(function(t,e){var n=t[1]-e[1];return isNaN(n)?e[1].localeCompare(t[1]):n}):a.sort(function(t,e){var n=e[1]-t[1];return isNaN(n)?t[1].localeCompare(e[1]):n});var r=a.map(function(t){return t[0]});x(r),d3.selectAll(".rowSortBox").classed("sortedBy",!1),d3.selectAll(".featureSortBox").classed("sortedBy",!1),d3.select(this).classed("sortedBy",!0);var o=d3.selectAll(".sortedBy").filter(".colSortBox");if(!o.empty()){var i=o.attr("class"),l=parseInt(i.match(/idx-(\d+)/)[1]);d3.selectAll(".colSortBox").classed("sortedBy",!1),d3.selectAll(".colSortBox").filter(".idx-"+r.indexOf(l)).classed("sortedBy",!0)}}),S.transition().duration(at.checked?T:0).attr("x",K+2).attr("y",function(t){return b-M.indexOf(t)*q}).attr("width",V).attr("height",q)}function l(){d3.selectAll(".sr-heatmap-table").remove();var t=["ROWNAME"];for(var e in H[0])H[0].hasOwnProperty(e)&&"ROWNAME"!==e&&t.push(e);var a=d3.select(n).append("table").attr("class","sr-heatmap-table"),r=a.append("thead"),o=a.append("tbody");r.append("tr").selectAll("th").data(t).enter().append("th").text(function(t){return t});var i=[],l=[];D.forEach(function(t){i.push(t.match(/.+(?=--)/)[0]),l.push(t.match(/.+?--(.*)/)[1])});var s=o.selectAll("tr").data(H).enter().append("tr");s.selectAll("td").data(function(e,n){return t.map(function(t){return{column:t,value:H[n][t]}})}).enter().append("td").text(function(t){return t.value})}function s(t){t/=100,V=20*t,q=10*t,K=V*F.length,X=q*D.length,ht.attr("width",K+Z.left+Z.right).attr("height",K+Z.top+Z.bottom);var e=T;T=0,i(),d(),T=e,o()}function c(e){It=[],e=Math.floor(e),d3.selectAll(".square").classed("cutoffHighlight",!1),d3.selectAll(".bar").classed("cutoffHighlight",!1),H.slice().sort(function(t,e){return r(t[U])-r(e[U])}).filter(function(t,n){return n<e}).forEach(function(e,n){It.push(e.ROWNAME),d3.select(".bar.idx-"+n).classed("cutoffHighlight",!0),d3.selectAll(".square.rowname-"+t.makeSafeForCSS(e.ROWNAME)).classed("cutoffHighlight",!0)})}function u(){0===It.length&&(e.params.selections.selectedRownames=[]),e.params.selections.selectedRownames=JSON.parse(JSON.stringify(e.params.selections.selectedRownames)).concat(It),$("run-button input").click()}function d(){$t&&(b(),g()),Nt&&(y(),v())}function p(e){var n=d3.selectAll(".square.colname-"+t.makeSafeForCSS(e));if(n.classed("selected")){var a=tt.indexOf(e);tt.splice(a,1),n.classed("selected",!1),d3.select(".selectText.colname-"+t.makeSafeForCSS(e)).text("□")}else tt.push(e),n.classed("selected",!0),d3.select(".selectText.colname-"+t.makeSafeForCSS(e)).text("■");0!==tt.length?d3.selectAll(".square:not(.selected)").attr("opacity",.4):d3.selectAll(".square").attr("opacity",1)}function m(e){var n=d3.scale.quantile().domain([0,1]).range(function(){for(var t=[],e=100,n=e;n--;)t.push(d3.rgb(255*n/e,0,0));for(n=e;n--;)t.push(d3.rgb(0,255*(e-n)/e,0));return t.reverse()}()),a=d3.scale.quantile().domain([0,1]).range(function(){for(var t=[],e=100,n=e;n--;)t.push(d3.rgb(255*n/e,0,0));for(n=e;n--;)t.push(d3.rgb(0,0,255*(e-n)/e));return t.reverse()}()),r=d3.scale.linear().domain([0,1]).range(["#0000ff","#e5e5ff"]),o=d3.scale.linear().domain([0,1]).range(["#00ff00","#e5ffe5"]),i={redGreen:n,blueScale:r,redBlue:a,greenScale:o};Ft=i[e],d3.selectAll(".square").transition().duration(at.checked?T:0).attr("fill",function(t){return Ft(1/(1+Math.pow(Math.E,-t.ZSCORE)))}),d3.selectAll(".legendColor").transition().duration(at.checked?T:0).attr("fill",function(t){return Ft(1/(1+Math.pow(Math.E,-t)))});var l=["#FF8000","#FFFF00"],s=["rgb(247,252,253)","rgb(224,236,244)","rgb(191,211,230)","rgb(158,188,218)","rgb(140,150,198)","rgb(140,107,177)","rgb(136,65,157)","rgb(129,15,124)","rgb(77,0,75)"],c=d3.scale.category10();M.forEach(function(e){d3.selectAll(".extraSquare.rowname-"+t.makeSafeForCSS(e)).style("fill",function(t){switch(t.TYPE){case"binary":return l[t.VALUE];case"subset":return l[t.VALUE-1];case"numeric":var e=d3.scale.quantile().domain([0,1]).range(s);return e(1/(1+Math.pow(Math.E,-t.ZSCORE)));default:return c(t.VALUE)}})}),f()}function f(){var t=Q/Ot.length,e=Y,n=Ct.selectAll(".legendColor").data(Ot,function(t){return t});n.enter().append("rect").attr("class","legendColor").attr("x",function(e,n){return 5-Z.left+n*t}).attr("y",8-Z.top+100).attr("width",Math.ceil(t)).attr("height",e),d3.selectAll(".legendText").remove(),Ct.append("text").attr("class","legendText").attr("x",5-Z.left).attr("y",8-Z.top+100).attr("text-anchor","start").text(Math.min.apply(null,Ot).toFixed(1)),Ct.append("text").attr("class","legendText").attr("x",5-Z.left+Q).attr("y",8-Z.top+100).attr("text-anchor","end").text(Math.max.apply(null,Ot).toFixed(1))}function h(){d3.selectAll(".selectText").text("□"),d3.selectAll(".square").classed("selected",!1).attr("opacity",1),tt=[]}function g(){var t=200,e=V*F.length,n=2*V+I+M.length*q-20,a=d3.layout.cluster().size([e,t]).separation(function(){return 1}),r=d3.svg.diagonal().projection(function(e){return[e.x,-n-t+e.y]}),o=a.nodes(Dt),i=a.links(o);ht.selectAll(".colDendrogramLink").data(i).enter().append("path").attr("class","colDendrogram link").attr("d",r),ht.selectAll(".colDendrogramNode").data(o).enter().append("circle").attr("class","colDendrogram node").attr("r",4.5).attr("transform",function(e){return"translate("+e.x+","+(-n-t+e.y)+")"}).on("click",function(t){var e=tt.slice();h();for(var n=t.index.split(" "),a=0;a<n.length;a++){var r=F[n[a]];p(r)}e.sort().toString()===tt.sort().toString()&&h()}).on("mouseover",function(t){gt.show("Height: "+t.height)}).on("mouseout",function(){gt.hide()}),$t=!0}function v(){var t=280,e=q*D.length,n=V+W+20,a=d3.layout.cluster().size([e,t]).separation(function(){return 1}),r=d3.svg.diagonal().projection(function(e){return[K+n+t-e.y,e.x]}),o=a.nodes(Bt),i=a.links(o);ht.selectAll(".rowDendrogramLink").data(i).enter().append("path").attr("class","rowDendrogram link").attr("d",r),ht.selectAll(".rowDendrogramNode").data(o).enter().append("circle").attr("class","rowDendrogram node").attr("r",4.5).attr("transform",function(e){return"translate("+(K+n+t-e.y)+","+e.x+")"}).on("click",function(t){var e=t.index.split(" "),n=[];e.forEach(function(t){var e=D[t],a=e.split("--");a.shift(),n=n.concat(a)});var a=$.ajax({url:baseURL+"/SmartR/biocompendium",type:"POST",timeout:5e3,data:{genes:n.join(" ")}});a.then(function(t){var e=t.match(/tmp_\d+/)[0],n="http://biocompendium.embl.de/cgi-bin/biocompendium.cgi?section=pathway&pos=0&background=whole_genome&session="+e+"&list=gene_list_1__1&list_size=15&org=human";window.open(n)},function(t){alert("Error:",t)})}).on("mouseover",function(t){gt.show("Height: "+t.height)}).on("mouseout",function(){gt.hide()}),Nt=!0}function b(){ht.selectAll(".colDendrogram").remove(),$t=!1}function y(){ht.selectAll(".rowDendrogram").remove(),Nt=!1}function x(t,e){e="undefined"==typeof e||e;var n=[];t.forEach(function(t){n.push(F[t])}),F=n,h(),b(),e&&i()}function w(t,e){e="undefined"==typeof e||e;var n=[],a=[];t.forEach(function(t){n.push(D[t]),a.push(H[t])}),D=n,H=a,y(),e&&i(),c()}function A(t,e){return t.map(function(t){return e.indexOf(t)})}function k(){return D.map(function(t){return z.indexOf(t)})}function S(){return F.map(function(t){return P.indexOf(t)})}function E(t){if(Wt||"undefined"!=typeof t){d3.selectAll(".box").classed("sortedBy",!1),t="undefined"==typeof t?Wt:t;var n=e.data.hclust[t];document.getElementById("sr-heatmap-row-check").checked&&D.length>0?(Bt=JSON.parse(n[3]),w(A(n[1],k()),!1),v(Bt)):y(),document.getElementById("sr-heatmap-col-check").checked&&F.length>0?(Dt=JSON.parse(n[2]),x(A(n[0],S()),!1),g(Dt)):b(),Wt=t,i()}}function C(t){U=t,a(),i()}function R(){var t=T;T=0,i(),d(),m("redGreen"),m("redGreen"),T=t}console.log(e.data);var T=1500,L=e.data.fields,O=e.data.extraFields,M=e.data.features.constructor===Array?e.data.features:[],F=e.data.colNames,D=e.data.rowNames,B=F.reduce(function(t,e){return e.length>t.length?e:t},""),I=t.getTextWidth(B),N=D.reduce(function(t,e){return e.length>t.length?e:t},""),W=t.getTextWidth(N),P=F.slice(),z=D.slice(),U=e.data.ranking[0].toUpperCase(),H=e.data.allStatValues,j=e.data.maxRows[0],_=JSON.parse(e.params.geneCardsAllowed),V=20,q=10,G=300,J=200,Q=200,Y=40,Z={top:2*q+I+M.length*q+G+100,right:V+300+G,bottom:10,left:J},K=V*F.length,X=q*D.length;t.prepareWindowSize(2*K+Z.left+Z.right,2*X+Z.top+Z.right);var tt=[],et=null,nt=null,at=t.getElementWithoutEventListeners("sr-heatmap-animate-check");at.checked=L.length<1e4;var rt=t.getElementWithoutEventListeners("sr-heatmap-zoom-range");rt.addEventListener("mouseup",function(){s(parseInt(rt.value))}),rt.value=100;var ot=function(){0===parseInt(lt.value)?it.value="Reset Cutoff":it.value="Apply Cutoff"},it=t.getElementWithoutEventListeners("sr-heatmap-cutoff-btn");it.addEventListener("click",u);var lt=t.getElementWithoutEventListeners("sr-heatmap-cutoff-range");lt.addEventListener("input",function(){c(parseInt(lt.value)),ot()}),lt.setAttribute("max",j-JSON.parse(JSON.stringify(e.params.selections.selectedRownames)).length-1),lt.value=0,lt.disabled=parseInt(lt.max)<=1,ot();var st=t.getElementWithoutEventListeners("sr-heatmap-cluster-select");st.addEventListener("change",function(){E(st.value)}),st.disabled=j<2,st.selectedIndex=0;var ct=t.getElementWithoutEventListeners("sr-heatmap-row-check");ct.disabled=j<2,ct.checked=!0;var ut=t.getElementWithoutEventListeners("sr-heatmap-col-check");ut.disabled=j<2,ut.checked=!0;var dt=t.getElementWithoutEventListeners("sr-heatmap-color-select");dt.addEventListener("change",function(){m(dt.value)}),dt.selectedIndex=0;var pt=t.getElementWithoutEventListeners("sr-heatmap-ranking-select");for(pt.addEventListener("change",function(){C(pt.value)});pt.firstChild;)pt.removeChild(pt.firstChild);for(var mt in H[0])if(H[0].hasOwnProperty(mt)&&"ROWNAME"!==mt){var ft=document.createElement("option");U===mt&&(ft.selected=!0),ft.setAttribute("value",mt),ft.innerHTML=mt.toLowerCase(),pt.appendChild(ft)}a();var ht=d3.select(n).append("svg").attr("width",4*(K+Z.left+Z.right)).attr("height",4*(X+Z.top+Z.bottom)).attr("class","visualization").append("g").attr("transform","translate("+Z.left+","+Z.top+")");o();var gt=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t});ht.call(gt);for(var vt=ht.append("g"),bt=ht.append("g"),yt=ht.append("g"),xt=ht.append("g"),wt=ht.append("g"),At=ht.append("g"),kt=ht.append("g"),St=ht.append("g"),Et=ht.append("g"),Ct=ht.append("g"),Rt=L.map(function(t){return t.ZSCORE}),Tt=Rt.reduce(function(t,e){return e>t?e:t}),Lt=Rt.reduce(function(t,e){return e<t?e:t}),Ot=[],Mt=Lt;Mt<Tt;Mt+=(Tt-Lt)/50)Ot.push(Mt);var Ft,Dt,Bt,It=[],$t=!1,Nt=!1,Wt=null;R()}return{restrict:"E",scope:{data:"=",width:"@",height:"@",params:"="},templateUrl:"src/containers/templates/heatmap.html",link:function(t,e){var n=e.children()[1];t.$watch("data",function(e){t.showControls=!1,angular.element(n).empty(),angular.isArray(e.fields)&&(t.showControls=!0,a(t,n))},!0)}}}]),angular.module("smartRApp").config(["$stateProvider",function(t){t.state("heatmap",{parent:"site",url:"/heatmap",views:{"@":{templateUrl:"src/containers/heatmap/heatmap.html"},"content@heatmap":{templateUrl:"src/containers/heatmap/heatmap.content.html"},"sidebar@heatmap":{templateUrl:"app/components/sidebar/sidebar.html",controller:"SidebarCtrl",controllerAs:"vm"}}})}]),angular.module("smartRApp").directive("timelinePlot",["smartRUtils","rServeService",function(t,e){function n(t,e){function n(t){t?(d3.selectAll(".timeBox").transition().duration(1500).style("stroke","white").style("fill","black"),d3.selectAll(".hoverline").transition().duration(1500).style("stroke","white"),it=!1):(d3.selectAll(".timeBox").transition().duration(1500).style("stroke","black").style("fill","white"),d3.selectAll(".hoverline").transition().duration(1500).style("stroke","black"),it=!0)}function a(){d3.selectAll(".line").each(function(t){for(var e=(d3.select(this),0),n=0;n<ot.domain().length;n++){var a=ot.domain()[n],r=h(t,U(void 0,a,void 0,void 0));if(r!==-1){var o=t[n-e];t[n-e]=t[r],t[r]=o}else e+=1}})}function r(t){for(var e=ot.range(),n=K/ot.domain().length,a=0;t>e[a]+n/2;a++);return a>Y.length-1&&(a=Y.length-1),ot.domain()[a]}function o(t){for(var e=ot.range(),n=(K/ot.domain().length,0);t>e[n];n++);return ot.domain()[n]}function i(t){for(var e=ot.range(),n=(K/ot.domain().length,0);t>e[n];n++);return ot.domain()[n-1]}function l(t,e){var n=ot.range()[1];d3.select(".global.x.axis.box.timepoint-"+t.replace(/ /g,"")).transition().duration(100).attr("x",ot(e)-n/2),d3.select(".global.x.axis.text.timepoint-"+t.replace(/ /g,"")).transition().duration(100).attr("transform","translate("+ot(e)+","+(tt+et+10+m())+")rotate(90)")}function s(t,e){l(Y[t],Y[e]),l(Y[e],Y[t]);var n=Y[e];Y[e]=Y[t],Y[t]=n,ot.domain(Y),dt.scale(ot)}function c(){v()}function u(){for(var t=d3.event.x,e=d3.select(this).property("__data__"),n=Y.indexOf(e),a=(ot.range()[1],r(t)),o=Y.indexOf(a);Math.abs(dist=n-o)>0;){var i=o;dist>1?i=n-1:dist<-1&&(i=n+1),s(n,i),n=i}}function d(){var t=d3.select(this).property("__data__");l(t,t),a(),O(!0),L()}function p(t){t?mt.interpolate("basis"):mt.interpolate("linear"),O()}function m(t){var e=5;return void 0===t?e*(J.length-1):e*t}function f(t){var e=r(t[0]),n=ot(e),a=n;ft.attr("x1",n).attr("x2",a).style("visibility","visible").moveToFront(),ht.attr("y1",t[1]).attr("y2",t[1]).style("visibility","visible").moveToFront()}function h(t,e){for(var n=0;n<t.length;n++)if(e(t[n],n,t))return n;return-1}function g(t,e){var n=gt[0]-wt/2,a=gt[1]-wt/2;e=e<n?n:e,e=e>a?a:e,"left"===t&&e>=parseInt(kt.attr("x"))?e=parseInt(kt.attr("x"))-1:"right"===t&&e<=parseInt(At.attr("x"))&&(e=parseInt(At.attr("x"))+1),d3.select(".brushbutton."+t).attr("x",e),"left"===t?vt.extent([e+wt/2,vt.extent()[1]]):vt.extent([vt.extent()[0],e+wt/2]),d3.select(".x.brush").call(vt),x()}function v(){g("left",gt[0]-wt/2),g("right",gt[1]-wt/2),x()}function b(){var t=vt.extent(),e=t[0],n=t[1];g("left",e),g("right",n)}function x(){ot.domain(Y);var t=vt.extent(),e=t[0],n=t[1],a=o(e),r=i(n),l=Y.slice(Y.indexOf(a),Y.indexOf(r)+1);vt.empty()?(v(),ot.domain(Y)):ot.domain(l),St&&l.toString()===St.toString()||(St=l.slice(),dt.scale(ot),O(),L())}function w(t){for(var e=0;e<Tt.length;e++)e!==t&&d3.select(".brush.box-"+e).call(Tt[e].clear())}function A(t){w(t)}function k(t,e){var n=Tt[t].extent(),a=n[0][0],r=n[0][1],l=n[1][0],s=n[1][1],c=o(a),u=i(l),d=Y.slice(Y.indexOf(c),Y.indexOf(u)+1),p=([e.invert(r),e.invert(s)],lt.append("path").attr("id","brushPolygon").attr("d","M"+a+" "+r+"L"+l+" "+r+"L"+l+" "+s+"L"+a+" "+s+"Z").style("fill","none").node());d3.selectAll(".line").classed("selected",!1).attr("opacity",1),selectedTimepoints=d,Et=[],d3.selectAll(".line").each(function(){var t=d3.select(this),e=t.node(),n=new Path(e),a=new Path(p),r=Intersection.intersectShapes(n,a);if("Intersection"===r.status){var o=d3.select(this).property("__data__")[0].patientID;d3.selectAll(".line.patientID-"+o).classed("selected",!0),Et.push(o)}}),Et.length>0&&d3.selectAll(".line:not(.selected)").attr("opacity",.4),d3.select("#brushPolygon").remove()}function S(){st.style("visibility","hidden"),w(-1),d3.selectAll(".line").classed("selected",!1)}function E(){Rt=[],d3.selectAll(".line").each(function(){Rt.push(d3.select(this).attr("stroke"))})}function C(){E();for(var t=0;t<Ct.length;t++){var e=Ct[t],n=Rt.indexOf(e);if(n===-1)return e}return""}function R(t){if(t=void 0===t?Et:t,0!==t.length){S();var e=C();if(""===e)return void alert("Sorry, no more colors available!");for(var n=0;n<t.length;n++){var a=t[n];d3.selectAll(".line.patientID-"+a).classed("assigned",!0).attr("stroke",e)}d3.selectAll(".line").attr("opacity",1)}}function T(){Rt=[],S();for(var t=0;t<Q.length;t++){var e=Q[t];d3.selectAll(".line.patientID-"+e).classed("assigned",!1).attr("opacity",1).attr("stroke",rt(e))}}function L(){lt.select(".local.x.axis").call(dt).selectAll("text").attr("class","text").attr("y",10).attr("x",5).attr("dy",".35em").attr("transform","rotate(45)").style("text-anchor","start")}function O(t){for(var e=t?500:0,n=0;n<J.length;n++){var a=J[n];y=Ot[a],lt.selectAll(".line.concept-"+n).transition().duration(e).attr("d",mt)}}function M(t,e){timelineBrush=d3.svg.brush().x(d3.scale.identity().domain([0,K])).y(d3.scale.identity().domain([t*Z+m(t),(t+1)*Z+m(t)])).on("brushstart",function(){A(t)}).on("brush",function(){st.style("visibility","hidden"),k(t,e)}),lt.append("g").attr("class","brush timlineBrush box-"+t).on("mousemove",function(){f(d3.mouse(this))}).on("mousedown",function(){2===d3.event.button&&d3.event.stopImmediatePropagation()}).call(timelineBrush),Tt.push(timelineBrush)}function F(t,e){var n=d3.svg.axis().scale(e).orient("left");lt.append("g").attr("class","local y axis").call(n).selectAll("text").attr("class","text").attr("dy",".35em").style("text-anchor","end")}function D(t,e){d3.selectAll(".line.patientID-"+t).classed("hovered",!0).moveToFront(),d3.selectAll(".line:not(.hovered)").attr("opacity",.4),e&&(f(d3.mouse(e)),ct.style("visibility","visible").html("PatientID: "+t).style("left",mouseX()+"px").style("top",mouseY()+"px"))}function B(){d3.selectAll(".line").classed("hovered",!1).attr("opacity",1),Et.length>0&&d3.selectAll(".line:not(.selected)").attr("opacity",.4),ct.style("visibility","hidden")}function I(t){var e=t[0].patientID;d3.select(".line.patientID-"+e).classed("hovered")||($(),D(e,this),z(e,this))}function $(){B(),N()}function N(){d3.selectAll(".correlogram").remove()}function W(t,e){var n=J.indexOf(e),a=(d3.extent(t,function(t){return t.value}),d3.scale.linear().domain([1,-1]).range([Z*n+m(n),Z*(n+1)+m(n)]));lt.append("line").attr("class","axis correlogram concept-"+n).attr("x1",0).attr("y1",a(0)).attr("x2",K).attr("y2",a(0)).attr("stroke",function(){return it?"black":"white"}),lt.selectAll(".correlogramBars").data(t).enter().append("rect").attr("class","bar correlogram concept-"+n).attr("width","1px").attr("height",function(t){return Math.abs(a(t.value)-a(0))}).attr("x",function(t){return ot(t.timepoint)}).attr("y",function(t){return a(Math.max(0,t.value))}).attr("stroke",function(){return it?"black":"white"})}function P(t){Lt=t}function z(t,e){if(Lt){var n={acfPatientID:t,xAxisSortOrder:ot.domain(),interpolateNAs:zt},a=function(t){for(var e=t.acfEstimates,n=0;n<J.length;n++){for(var a=J[n],r=e[a],o=[],i=0,l=r.estimate.length;i<l;i++)o.push({value:r.estimate[i],timepoint:r.sortOrder[i]});W(o,a)}d3.selectAll(".line.hovered").size()||N()};startWorkflow(a,n,!1,!1)}}function U(t,e,n,a){return function(r){var o=void 0===t||r.concept===t,i=void 0===e||r.timepoint===e,l=void 0===n||r.patientID===n,s=void 0===a||r.value===a;return o&&i&&l&&s}}function H(t){for(var e={},n=[],a=0,r=0,o=t.length;a<o;a++){var i=t[a];1!==e[i]&&(e[i]=1,n[r++]=i)}return n}function j(){lt.selectAll(".dendrogram").remove()}function _(t,e,n,a){var r=280,o=a-n,i=d3.layout.cluster().size([o,r]).separation(function(t,e){return 1}),l=d3.svg.diagonal().projection(function(t){return[X+at.right-20-t.y,n+t.x]}),s=i.nodes(t),c=i.links(s);dendrogramLink=lt.selectAll(".dendrogramLink").data(c).enter().append("path").attr("class","dendrogram link").attr("d",l),dendrogramNode=lt.selectAll(".dendrogramNode").data(s).enter().append("circle").attr("class","dendrogram node").attr("r",4.5).attr("transform",function(t){return"translate("+(X+at.right-20-t.y)+","+(n+t.x)+")"}).on("mouseover",function(t){for(var n=t.index.split(" "),a=0;a<n.length;a++){var r=e[n[a]];D(r)}ct.style("visibility","visible").html("Height: "+t.height).style("left",mouseX()+"px").style("top",mouseY()+"px")}).on("mouseout",function(){B(),ct.style("visibility","hidden")}).on("click",function(t){for(var n=t.index.split(" "),a=[],r=0;r<n.length;r++){var o=e[n[r]];a.push(o)}R(a)})}function V(t){t?zt=1:(alert("Missing timepoints are no longer interpolated.\nThis can massively influence the analysis algorithms (i.e. clustering)\n\nDEACTIVATE ONLY IF YOU KNOW WHAT YOU DO!"),zt=0)}function q(t,e){j();var n=t,a=e,r={similarityMeasure:n,linkageMeasure:a,interpolateNAs:zt,xAxisSortOrder:ot.domain()};_t.select(".buttonText").text("Loading...");var o=function(t){_t.select(".buttonText").text("Timeline Clustering");for(var e=0;e<J.length;e++){var n=J[e],a=JSON.parse(t.clusterings[n].dendrogram),r=Z*e+m(e),o=Z*(e+1)+m(e),i=t.clusterings[n].patientIDs;
_(a,i,r,o)}};startWorkflow(o,r,!1,!1)}d3.selection.prototype.moveToFront=function(){return this.each(function(){this.parentNode.appendChild(this)})};var G=results.data,J=results.concepts,Q=results.patientIDs,Y=results.timepoints,Z=200,K=1e3,X=K,tt=Z*J.length,et=100,nt=0,at={top:50,right:330,bottom:et+100,left:240},rt=d3.scale.category10().domain(Q),ot=d3.scale.ordinal().domain(Y).rangePoints([0,K]),it=!1,lt=d3.select("#visualization").append("svg").attr("width",X+at.left+at.right).attr("height",tt+at.top+at.bottom).append("g").attr("transform","translate("+at.left+","+at.top+")"),st=d3.select("#visualization").append("div").attr("class","contextMenu text").style("visibility","hidden").html("<input id='setColorButton' class='mybutton' type='button' value='Assign Unique Color' onclick='assignUniqueColor()'/><br/><input id='resetColorsButton' class='mybutton' type='button' value='Reset Line Colors' onclick='resetLineColors()'/>");d3.select("#visualization").on("contextmenu",function(){d3.event.preventDefault(),st.style("visibility","visible").style("left",mouseX()+"px").style("top",mouseY()+"px")});var ct=d3.select("#visualization").append("div").attr("class","tooltip text").style("visibility","hidden"),ut=d3.behavior.drag().on("dragstart",c).on("drag",u).on("dragend",d),dt=d3.svg.axis().scale(ot).orient("bottom");lt.append("g").attr("class","local x axis").attr("transform","translate(0,"+(tt+nt+m())+")").call(dt).selectAll("text").attr("class","text").attr("y",10).attr("x",5).attr("dy",".35em").attr("transform","rotate(45)").style("text-anchor","start"),lt.append("g").attr("class","global x axis").attr("transform","translate(0,"+(tt+et+m())+")").call(dt).selectAll("text").attr("class","text").attr("visibility","hidden");var pt=lt.selectAll(".globalXAxisLabels").data(Y).enter().append("g").attr("class","draggableTimepoints").call(ut);pt.append("text").attr("class",function(t){return"global x axis text timepoint-"+t.replace(/ /g,"")}).attr("transform",function(t){return"translate("+ot(t)+","+(tt+et+10+m())+")rotate(90)"}).attr("dy","0.35em").attr("text-anchor","start").text(function(t){return t}),maxTextWidth=getMaxWidth(d3.selectAll(".global.x.axis.text")),pt.append("rect").attr("class",function(t){return"global x axis box timepoint-"+t.replace(/ /g,"")}).attr("x",function(t){return ot(t)-ot.range()[1]/2}).attr("y",tt+et+10-2+m()).attr("width",K/Y.length).attr("height",maxTextWidth+4);var mt=d3.svg.line().defined(function(t){return ot.domain().indexOf(t.timepoint)!==-1}).x(function(t){return ot(t.timepoint)}).y(function(t){return y(t.value)}).interpolate("linear"),ft=(lt.selectAll(".timelineBoxText").data(J).enter().append("text").attr("class","text").attr("transform",function(t,e){return"translate("+(K+10)+","+(e*Z+Z/2+m(e))+")rotate(90)"}).attr("dy",".35em").style("text-anchor","middle").text(function(t){return shortenConcept(t)}),lt.selectAll(".timelineBox").data(J).enter().append("rect").attr("class","timeBox").attr("width",K).attr("height",Z).attr("x",0).attr("y",function(t,e){return Z*e+m(e)}).on("mousemove",function(){f(d3.mouse(this))}),lt.append("line").attr("class","hoverline").attr("y1",0).attr("y2",tt+nt+7).style("visibility","hidden")),ht=lt.append("line").attr("class","hoverline").attr("x1",-7).attr("x2",K).style("visibility","hidden"),gt=[-10,K+10],vt=d3.svg.brush().x(d3.scale.identity().domain(gt)).extent(gt).on("brush",function(){b(),x()}),bt=50;lt.append("g").attr("class","x brush").call(vt).selectAll("rect").attr("y",tt+et+m()-.5*bt).attr("height",bt);for(var yt=d3.behavior.drag().on("drag",function(){return g("left",d3.event.x)}),xt=d3.behavior.drag().on("drag",function(){return g("right",d3.event.x)}),wt=10,At=lt.append("rect").attr("class","brushbutton left").attr("y",tt+et+m()-.25*bt).attr("height",bt/2).attr("width",wt).call(yt),kt=lt.append("rect").attr("class","brushbutton right").attr("y",tt+et+m()-.25*bt).attr("height",bt/2).attr("width",wt).call(xt),St=[],Et=[],Ct=["#1b9e77","#d95f02","#7570b3","#e7298a","#66a61e","#e6ab02","#a6761d","#666666"],Rt=[],Tt=[],Lt=!0,Ot={},Mt=0;Mt<J.length;Mt++){var Ft=J[Mt],Dt=G.filter(U(Ft,void 0,void 0,void 0)),Bt=H(Dt.map(function(t){return t.patientID})),It=d3.extent(Dt,function(t){return t.value}),$t=d3.scale.linear().domain(It.reverse()).range([Z*Mt+m(Mt),Z*(Mt+1)+m(Mt)]);Ot[Ft]=$t,y=$t,M(Mt,$t),F(Mt,$t);for(var Nt=0;Nt<Bt.length;Nt++){var Wt=Bt[Nt],Pt=G.filter(U(Ft,void 0,Wt,void 0));timeline=lt.selectAll(".timelines").data([Pt]).enter().append("path").attr("class","line concept-"+Mt+" patientID-"+Wt).attr("d",mt).attr("stroke",rt(Wt)).on("mouseover",I).on("mouseout",$).on("mousemove",function(){f(d3.mouse(this))})}}v();var zt=1,Ut=200,Ht=40,jt=5,_t=createD3Dropdown({location:lt,label:"Timeline Clustering",x:2-at.left,y:2-at.top,width:Ut,height:Ht,items:[{callback:function(){q("COR","average")},label:"Hierarch.-Corr.-Avg."},{callback:function(){q("EUCL","average")},label:"Hierarch.-Eucl.-Avg."},{callback:function(){q("ACF","average")},label:"Hierarch.-Autocorr.-Avg."}]});createD3Button({location:lt,label:"Reset Colors",x:2-at.left+jt+Ut,y:2-at.top,width:Ut,height:Ht,callback:T}),createD3Switch({location:lt,onlabel:"Interp. Miss. Data ON",offlabel:"Interp. Miss. Data OFF",x:2-at.left+2*jt+2*Ut,y:2-at.top,width:Ut,height:Ht,callback:V,checked:!0}),createD3Switch({location:lt,onlabel:"Dark Background",offlabel:"Light Background",x:2-at.left+3*jt+3*Ut,y:2-at.top,width:Ut,height:Ht,callback:n,checked:!0}),createD3Switch({location:lt,onlabel:"Smooth Data ON",offlabel:"Smooth Data OFF",x:2-at.left+4*jt+4*Ut,y:2-at.top,width:Ut,height:Ht,callback:p,checked:!1}),createD3Switch({location:lt,onlabel:"SHOW Correlogram",offlabel:"HIDE Correlogram",x:2-at.left+5*jt+5*Ut,y:2-at.top,width:Ut,height:Ht,callback:P,checked:!0})}return{restrict:"E",scope:{data:"=",width:"@",height:"@"},link:function(t,e){t.$watch("data",function(){$(e[0]).empty(),t.data&&n(t,e[0])})}}}]),angular.module("smartRApp").config(["$stateProvider",function(t){t.state("timeline",{parent:"site",url:"/timeline",views:{"@":{templateUrl:"src/containers/timeline/timeline.html"},"content@timeline":{templateUrl:"src/containers/timeline/timeline.content.html"},"sidebar@timeline":{templateUrl:"app/components/sidebar/sidebar.html",controller:"SidebarCtrl",controllerAs:"vm"}}})}]),angular.module("smartRApp").directive("volcanoPlot",["smartRUtils",function(t){function e(e,n){function a(){var t=d3.event.y;t<0&&(t=0),t>y&&(t=y),d3.selectAll(".pLine").attr("y1",t).attr("y2",t),d3.selectAll(".pHandle").attr("y",t-6),d3.selectAll(".pText").attr("y",t).text("p = "+(1/Math.pow(10,S.invert(t))).toFixed(5)),g=S.invert(t),d3.selectAll(".point").style("fill",function(t){return i(t)}),s(o().data())}function r(){var t=d3.event.x;t<0&&(t=0),t>b&&(t=b);var e=k.invert(t);d3.selectAll(".logFCLine.left").attr("x1",k(-Math.abs(e))).attr("x2",k(-Math.abs(e))),d3.selectAll(".logFCHandle.left").attr("x",k(-Math.abs(e))-6),d3.selectAll(".logFCText.left").attr("x",k(-Math.abs(e))).text("log2FC = "+(-Math.abs(e)).toFixed(2)),d3.selectAll(".logFCLine.right").attr("x1",k(Math.abs(e))).attr("x2",k(Math.abs(e))),d3.selectAll(".logFCHandle.right").attr("x",k(Math.abs(e))-6),d3.selectAll(".logFCText.right").attr("x",k(Math.abs(e))).text("log2FC = "+Math.abs(e).toFixed(2)),h=Math.abs(e),d3.selectAll(".point").style("fill",function(t){return i(t)}),s(o().data())}function o(){return d3.selectAll(".point").filter(function(t){return t.negativeLog10PValues>g&&Math.abs(t.logFC)>h})}function i(t){return t.negativeLog10PValues<g&&Math.abs(t.logFC)<h?"#000000":t.negativeLog10PValues>=g&&Math.abs(t.logFC)<h?"#FF0000":t.negativeLog10PValues>=g&&Math.abs(t.logFC)>=h?"#00FF00":"#0000FF"}function l(){d3.selectAll(".volcanoplot-table").remove()}function s(t){if(l(),t.length){var e=["uid","logFC","negativeLog10PValues","pValue"],a=["ID","log2 FC","- log10 p","p"],r=d3.select(n).append("table").attr("class","volcanoplot-table"),o=r.append("thead"),i=r.append("tbody");o.append("tr").attr("class","mytr").selectAll("th").data(a).enter().append("th").attr("class","myth").text(function(t){return t});var s=i.selectAll("tr").data(t).enter().append("tr").attr("class","mytr");s.selectAll("td").data(function(t){return e.map(function(e){return{column:e,value:t[e]}})}).enter().append("td").attr("class","text mytd").text(function(t){return t.value})}}function c(){var e=x.selectAll(".point").data(f,function(t){return t.uid});e.enter().append("rect").attr("class",function(e){return"point uid-"+t.makeSafeForCSS(e.uid)}).attr("x",function(t){return k(t.logFC)-2}).attr("y",function(t){return S(t.negativeLog10PValues)-2}).attr("width",4).attr("height",4).style("fill",function(t){return i(t)}).on("mouseover",function(t){var e="ID: "+t.uid+"<br/>p-value: "+t.pValue+"<br/>-log10 p: "+t.negativeLog10PValues+"<br/>log2FC: "+t.logFC;w.show(e)}).on("mouseout",function(){w.hide()}),e.exit().attr("r",0).remove()}var u=e.data.uids,d=e.data.pvalValues,p=e.data.negativeLog10PvalValues,m=e.data.logfoldValues,f=p.map(function(t,e){return{uid:u[e],pValue:d[e],negativeLog10PValues:p[e],logFC:m[e]}}),h=.5,g=-Math.log10(.05),v={top:100,right:100,bottom:100,left:100},b=e.width-v.left-v.right,y=e.height-v.top-v.bottom,x=d3.select(n).append("svg").style("float","left").attr("width",b+v.left+v.right).attr("height",y+v.top+v.bottom).append("g").attr("transform","translate("+v.left+","+v.top+")"),w=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return t});x.call(w);var A=Math.max.apply(null,m.map(Math.abs)),k=d3.scale.linear().domain([-A,A]).range([0,b]),S=d3.scale.linear().domain(d3.extent(p)).range([y,0]),E=d3.svg.axis().scale(k).orient("bottom"),C=d3.svg.axis().scale(S).orient("left");x.append("g").attr("class","axis").attr("transform","translate(0,"+y+")").call(E),x.append("g").attr("class","axis").call(C),x.append("g").attr("class","x axis").attr("transform","translate(0, 0)").call(d3.svg.axis().scale(k).ticks(10).tickFormat("").innerTickSize(y).orient("bottom")),x.append("g").attr("class","y axis").attr("transform","translate("+b+",0)").call(d3.svg.axis().scale(S).ticks(10).tickFormat("").innerTickSize(b).orient("left")),x.append("text").attr("class","text axisText").attr("x",b/2).attr("y",y+40).attr("text-anchor","middle").text("log2 FC"),x.append("text").attr("class","text axisText").attr("text-anchor","middle").attr("transform","translate(-40,"+y/2+")rotate(-90)").text("- log10 p");var R=d3.behavior.drag().on("drag",a).on("dragend",d3.tip);x.append("line").attr("class","pLine").attr("x1",0).attr("y1",S(g)).attr("x2",b).attr("y2",S(g)),x.append("rect").attr("class","pHandle").attr("x",0).attr("y",S(g)-6).attr("width",b).attr("height",12).call(R),x.append("text").attr("class","text pText").attr("x",b+5).attr("y",S(g)).attr("dy","0.35em").attr("text-anchor","start").text("p = 0.0500").style("fill","red");var T=d3.behavior.drag().on("drag",r);x.append("line").attr("class","left logFCLine").attr("x1",k(-h)).attr("y1",y).attr("x2",k(-h)).attr("y2",0),x.append("rect").attr("class","left logFCHandle").attr("x",k(-h)-6).attr("y",0).attr("width",12).attr("height",y).call(T),x.append("text").attr("class","text left logFCText").attr("x",k(-h)).attr("y",-15).attr("dy","0.35em").attr("text-anchor","end").text("log2FC = "+-h).style("fill","#0000FF"),x.append("line").attr("class","right logFCLine").attr("x1",k(h)).attr("y1",y).attr("x2",k(h)).attr("y2",0),x.append("rect").attr("class","right logFCHandle").attr("x",k(h)-6).attr("y",0).attr("width",12).attr("height",y).call(T),x.append("text").attr("class","text right logFCText").attr("x",k(h)).attr("y",-15).attr("dy","0.35em").attr("text-anchor","start").text("log2FC = "+h).style("fill","#0000FF"),c(),s(o().data())}return{restrict:"E",scope:{data:"=",width:"@",height:"@"},link:function(n,a){n.$watch("data",function(){$(a[0]).empty(),$.isEmptyObject(n.data)||(t.prepareWindowSize(n.width,n.height),e(n,a[0]))})}}}]),angular.module("smartRApp").config(["$stateProvider",function(t){t.state("volcanoplot",{parent:"site",url:"/volcanoplot",views:{"@":{templateUrl:"src/containers/volcanoplot/volcanoplot.html"},"content@volcanoplot":{templateUrl:"src/containers/volcanoplot/volcanoplot.content.html"},"sidebar@volcanoplot":{templateUrl:"app/components/sidebar/sidebar.html",controller:"SidebarCtrl",controllerAs:"vm"}}})}]);